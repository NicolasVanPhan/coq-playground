<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>cpdt_notes</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library cpdt_notes</h1>

<div class="code">

<br/>

<br/>

<br/>

<br/>
</div>

<div class="doc">
<a id="lab1"></a><h1 class="section">3.8 - Nested Inductive Types</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Module</span> <a id="Nested_inductive_types" class="idref" href="#Nested_inductive_types"><span class="id" title="module">Nested_inductive_types</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab2"></a><h2 class="section">Q: Give an example of nested inductive type</h2>
 </div><details><summary>Answer</summary><div class="doc"> 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <a id="Nested_inductive_types.nat_tree" class="idref" href="#Nested_inductive_types.nat_tree"><span class="id" title="definition, inductive"><span id="Nested_inductive_types.nat_tree_rect" class="id"><span id="Nested_inductive_types.nat_tree_ind" class="id"><span id="Nested_inductive_types.nat_tree_rec" class="id"><span id="Nested_inductive_types.nat_tree_sind" class="id">nat_tree</span></span></span></span></span></a> : <span class="id" title="keyword">Set</span> :=<br/>
| <a id="Nested_inductive_types.NNode" class="idref" href="#Nested_inductive_types.NNode"><span class="id" title="constructor">NNode</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="cpdt_notes.html#nat_tree:214"><span class="id" title="inductive">nat_tree</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#nat_tree:214"><span class="id" title="inductive">nat_tree</span></a><br/>
.<br/>

<br/>
</div>

<div class="doc">
<a id="lab3"></a><h2 class="section">Q: Why is it called "nested" ?</h2>
              </div><details><summary>Answer</summary><div class="doc"> 
<div class="paragraph"> </div>


<div class="paragraph"> </div>

Because it uses the type we're defining (here <span class="inlinecode"><span class="id" title="var">nat_tree</span></span>)
as an argument to a parametrized type family (here <span class="inlinecode"><span class="id" title="var">list</span></span>).

</div>
<div class="code">

<br/>
</div>

<div class="doc">
<a id="lab4"></a><h2 class="section">Q: What's the problem with it ?</h2>
              </div><details><summary>Answer</summary><div class="doc"> 
<div class="paragraph"> </div>


<div class="paragraph"> </div>

Not all nested inductive type definitions will be allowed.
Some will violate the positivity rule.

</div>
<div class="code">

<br/>
</div>

<div class="doc">
<a id="lab5"></a><h2 class="section">Q: Give an example of type definition violating the positivity rule</h2>
              </div><details><summary>Answer</summary><div class="doc"> 
<div class="paragraph"> </div>

 TODO : Answer this one 
<div class="paragraph"> </div>

  </div> </details> <div class="doc">  
</div>
<div class="code">

<br/>
</div>

<div class="doc">
<a id="lab6"></a><h2 class="section">Q: What is the usual problem with nested inductive types ?</h2>
              </div><details><summary>Answer</summary><div class="doc"> 
<div class="paragraph"> </div>


<div class="paragraph"> </div>

The generated induction principle is too weak,
so we have to manually write a more powerful one.

</div>
<div class="code">

<br/>
</div>

<div class="doc">
<a id="lab7"></a><h2 class="section">Q: Give the default generate induction principle</h2>
              </div><details><summary>Answer</summary><div class="doc"> 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Check</span> (<a class="idref" href="cpdt_notes.html#Nested_inductive_types.nat_tree_ind"><span class="id" title="definition">nat_tree_ind</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="P:216" class="idref" href="#P:216"><span class="id" title="binder">P</span></a> : <a class="idref" href="cpdt_notes.html#Nested_inductive_types.nat_tree"><span class="id" title="inductive">nat_tree</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span>,                              <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> (<a id="n:217" class="idref" href="#n:217"><span class="id" title="binder">n</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="l:218" class="idref" href="#l:218"><span class="id" title="binder">l</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="cpdt_notes.html#Nested_inductive_types.nat_tree"><span class="id" title="inductive">nat_tree</span></a>), <a class="idref" href="cpdt_notes.html#P:216"><span class="id" title="variable">P</span></a> (<a class="idref" href="cpdt_notes.html#Nested_inductive_types.NNode"><span class="id" title="constructor">NNode</span></a> <a class="idref" href="cpdt_notes.html#n:217"><span class="id" title="variable">n</span></a> <a class="idref" href="cpdt_notes.html#l:218"><span class="id" title="variable">l</span></a>)<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a>   <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">∀</span> <a id="t:219" class="idref" href="#t:219"><span class="id" title="binder">t</span></a> : <a class="idref" href="cpdt_notes.html#Nested_inductive_types.nat_tree"><span class="id" title="inductive">nat_tree</span></a>, <a class="idref" href="cpdt_notes.html#P:216"><span class="id" title="variable">P</span></a> <a class="idref" href="cpdt_notes.html#t:219"><span class="id" title="variable">t</span></a>                             <br/>
).<br/>

<br/>
</div>

<div class="doc">
<a id="lab8"></a><h2 class="section">Q:</h2>
              </div><details><summary>Answer</summary><div class="doc"> 
</div>
<div class="code">

<br/>
</div>

<div class="doc">
              </div> </details> <div class="doc">                 </div> </details> <div class="doc">                 </div> </details> <div class="doc">                 </div> </details> <div class="doc">                 </div> </details> <div class="doc">                 </div> </details> <div class="doc">  
</div>
<div class="code">

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="cpdt_notes.html#Nested_inductive_types"><span class="id" title="module">Nested_inductive_types</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab9"></a><h1 class="section">3.9 - Manual Proofs about Constructors</h1>

<div class="paragraph"> </div>


<div class="paragraph"> </div>

  What are True and False ?

<div class="paragraph"> </div>

  &gt; They are logical propositions ?

<div class="paragraph"> </div>

  Okay, what are logicial propositions concretely ?

<div class="paragraph"> </div>

  &gt; They are types (whose inhabitants are the proofs for those propositions)
  &gt; They are values (of type Prop)

<div class="paragraph"> </div>

  What's so special about Prop / Set / Type ?
  Why can't we define True as before but with : Set instead of : Prop ?

<div class="paragraph"> </div>

  
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a id="toProp" class="idref" href="#toProp"><span class="id" title="definition">toProp</span></a> (<a id="b:220" class="idref" href="#b:220"><span class="id" title="binder">b</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a>) := <span class="id" title="keyword">if</span> <a class="idref" href="cpdt_notes.html#b:220"><span class="id" title="variable">b</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#True"><span class="id" title="inductive">True</span></a> <span class="id" title="keyword">else</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#False"><span class="id" title="inductive">False</span></a>.<br/>

<br/>
<span class="id" title="keyword">Theorem</span> <a id="true_neq_false" class="idref" href="#true_neq_false"><span class="id" title="lemma">true_neq_false</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#True"><span class="id" title="inductive">True</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#False"><span class="id" title="inductive">False</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">red</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">H</span>.<br/>

<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Ht</span> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#True"><span class="id" title="inductive">True</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="cpdt_notes.html#toProp"><span class="id" title="definition">toProp</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>). { <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Hf</span> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#False"><span class="id" title="inductive">False</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="cpdt_notes.html#toProp"><span class="id" title="definition">toProp</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>). { <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Ht</span> <span class="id" title="tactic">in</span> ×.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hf</span> <span class="id" title="tactic">in</span> ×.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Ht</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exact</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#I"><span class="id" title="constructor">I</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab10"></a><h1 class="section">4.0 - Inductive Predicates</h1>

</div>
<div class="code">

<br/>
</div>

<div class="doc">
<a id="lab11"></a><h2 class="section">Q: Recall definition of <span class="inlinecode"><span class="id" title="var">unit</span></span> and <span class="inlinecode"><span class="id" title="var">True</span></span>, and fundamental difference ?</h2>

</div>
<div class="code">
<span class="id" title="keyword">Inductive</span> <a id="my_unit" class="idref" href="#my_unit"><span class="id" title="definition, inductive"><span id="my_unit_rect" class="id"><span id="my_unit_ind" class="id"><span id="my_unit_rec" class="id"><span id="my_unit_sind" class="id">my_unit</span></span></span></span></span></a> : <span class="id" title="keyword">Set</span> := <a id="my_tt" class="idref" href="#my_tt"><span class="id" title="constructor">my_tt</span></a> : <a class="idref" href="cpdt_notes.html#my_unit:221"><span class="id" title="inductive">my_unit</span></a>.<br/>
<span class="id" title="keyword">Inductive</span> <a id="my_True" class="idref" href="#my_True"><span class="id" title="definition, inductive"><span id="my_True_rect" class="id"><span id="my_True_ind" class="id"><span id="my_True_rec" class="id"><span id="my_True_sind" class="id">my_True</span></span></span></span></span></a> : <span class="id" title="keyword">Prop</span> := <a id="my_I" class="idref" href="#my_I"><span class="id" title="constructor">my_I</span></a> : <a class="idref" href="cpdt_notes.html#my_True:223"><span class="id" title="inductive">my_True</span></a>.<br/>

<br/>
<span class="id" title="keyword">Print</span> <span class="id" title="var">my_unit</span>.<br/>
<span class="id" title="keyword">Print</span> <span class="id" title="var">unit</span>.<br/>
<span class="id" title="keyword">Print</span> <span class="id" title="var">my_True</span>.<br/>
<span class="id" title="keyword">Print</span> <span class="id" title="var">True</span>.<br/>

<br/>
</div>

<div class="doc">
The differneces are :
<ul class="doclist">
<li> name (my_unit vs my_True), detail

</li>
<li> constructor name (tt vs I), detail

</li>
<li> Kind : Set vs Prop, that is the main difference.

</li>
</ul>

</div>
<div class="code">

<br/>
</div>

<div class="doc">
<a id="lab12"></a><h2 class="section">Q: Why not merging the two into 1 single type ?</h2>

<div class="paragraph"> </div>

<ul class="doclist">
<li> Main argument : Proof irrelevance
  All functions <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="var">Q</span></span> are not created equal, but all proof of proposition <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="var">Q</span></span> are.

</li>
<li> Plus some other arguments on compilation efficiency

</li>
</ul>

</div>
<div class="code">

<br/>
</div>

<div class="doc">
<a id="lab13"></a><h2 class="section">Q: Goal of this chapter ?</h2>

<div class="paragraph"> </div>

See how to define predicates with inductive definitions.

</div>
<div class="code">

<br/>
</div>

<div class="doc">
<a id="lab14"></a><h1 class="section">4.1 - Propositional Logic</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Section</span> <a id="Propositional" class="idref" href="#Propositional"><span class="id" title="section">Propositional</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variables</span> <a id="Propositional.P" class="idref" href="#Propositional.P"><span class="id" title="variable">P</span></a> <a id="Propositional.Q" class="idref" href="#Propositional.Q"><span class="id" title="variable">Q</span></a> <a id="Propositional.R" class="idref" href="#Propositional.R"><span class="id" title="variable">R</span></a> : <span class="id" title="keyword">Prop</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <a id="ex_falso_example" class="idref" href="#ex_falso_example"><span class="id" title="lemma">ex_falso_example</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#False"><span class="id" title="inductive">False</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> 2 <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> 2 <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> 5.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">HF</span>. <span class="id" title="var">exfalso</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">HF</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab15"></a><h2 class="section">Q: How to avoid the boilerplate of dealing with and/or/not ?</h2>

  e.g. Prove <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode">∨</span> <span class="inlinecode"><span class="id" title="var">Q</span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="var">Q</span></span> <span class="inlinecode">∨</span> <span class="inlinecode"><span class="id" title="var">P</span></span> without manual use of <span class="inlinecode"><span class="id" title="tactic">left</span></span>, <span class="inlinecode"><span class="id" title="tactic">right</span></span>, etc.
  
<div class="paragraph"> </div>

 <span class="inlinecode"><span class="id" title="tactic">tauto</span></span> to the rescue ! Complete decision procedure for constructive propositional logic. 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <a id="pq_qp" class="idref" href="#pq_qp"><span class="id" title="lemma">pq_qp</span></a> : <a class="idref" href="cpdt_notes.html#Propositional.P"><span class="id" title="variable">P</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">∨</span></a> <a class="idref" href="cpdt_notes.html#Propositional.Q"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#Propositional.Q"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">∨</span></a> <a class="idref" href="cpdt_notes.html#Propositional.P"><span class="id" title="variable">P</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">tauto</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab16"></a><h2 class="section">Q: What if <span class="inlinecode"><span class="id" title="tactic">tauto</span></span> fails because of some missing hypothesis ?</h2>

<div class="paragraph"> </div>

 Use <span class="inlinecode"><span class="id" title="tactic">intuition</span></span> instead, it will leave us the remaining bits to prove.
  
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <a id="arith_common" class="idref" href="#arith_common"><span class="id" title="lemma">arith_common</span></a> : <span class="id" title="keyword">∀</span> <a id="l1:231" class="idref" href="#l1:231"><span class="id" title="binder">l1</span></a> <a id="l2:232" class="idref" href="#l2:232"><span class="id" title="binder">l2</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="cpdt_notes.html#l1:231"><span class="id" title="variable">l1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="cpdt_notes.html#l2:232"><span class="id" title="variable">l2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">∨</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="cpdt_notes.html#l1:231"><span class="id" title="variable">l1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="cpdt_notes.html#l2:232"><span class="id" title="variable">l2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> 6<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> (<a class="idref" href="cpdt_notes.html#l1:231"><span class="id" title="variable">l1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <a class="idref" href="cpdt_notes.html#l2:232"><span class="id" title="variable">l2</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> 6 <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">∨</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="cpdt_notes.html#l1:231"><span class="id" title="variable">l1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="cpdt_notes.html#l2:232"><span class="id" title="variable">l2</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">length_app</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab17"></a><h2 class="section">Q: Common clean way to rewrite the above proof ?</h2>

<div class="paragraph"> </div>


<div class="paragraph"> </div>

  The <span class="inlinecode"><span class="id" title="tactic">intuition</span></span> tactic could work if it knew about <span class="inlinecode"><span class="id" title="var">length_app</span></span> for rewrites.

<div class="paragraph"> </div>

  First give the rewrite hint, then call <span class="inlinecode"><span class="id" title="var">crush</span></span>, which calls <span class="inlinecode"><span class="id" title="tactic">intuition</span></span> actually.
  
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <a id="arith_common_v2" class="idref" href="#arith_common_v2"><span class="id" title="lemma">arith_common_v2</span></a> : <span class="id" title="keyword">∀</span> <a id="l1:233" class="idref" href="#l1:233"><span class="id" title="binder">l1</span></a> <a id="l2:234" class="idref" href="#l2:234"><span class="id" title="binder">l2</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="cpdt_notes.html#l1:233"><span class="id" title="variable">l1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="cpdt_notes.html#l2:234"><span class="id" title="variable">l2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">∨</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="cpdt_notes.html#l1:233"><span class="id" title="variable">l1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="cpdt_notes.html#l2:234"><span class="id" title="variable">l2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> 6<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> (<a class="idref" href="cpdt_notes.html#l1:233"><span class="id" title="variable">l1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <a class="idref" href="cpdt_notes.html#l2:234"><span class="id" title="variable">l2</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> 6 <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">∨</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="cpdt_notes.html#l1:233"><span class="id" title="variable">l1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="cpdt_notes.html#l2:234"><span class="id" title="variable">l2</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Hint Rewrite</span> <span class="id" title="lemma">length_app</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">crush</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="cpdt_notes.html#Propositional"><span class="id" title="section">Propositional</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab18"></a><h1 class="section">4.5 - Recursive Predicates</h1>

</div>
<div class="code">

<br/>
</div>

<div class="doc">
<a id="lab19"></a><h2 class="section">Q: Define <span class="inlinecode"><span class="id" title="var">even</span></span> and manually prove <span class="inlinecode"><span class="id" title="var">even</span></span> <span class="inlinecode">0</span>, <span class="inlinecode"><span class="id" title="var">even</span></span> <span class="inlinecode">4</span></h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <a id="even" class="idref" href="#even"><span class="id" title="definition, inductive"><span id="even_ind" class="id"><span id="even_sind" class="id">even</span></span></span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
| <a id="even_O" class="idref" href="#even_O"><span class="id" title="constructor">even_O</span></a> : <a class="idref" href="cpdt_notes.html#even:235"><span class="id" title="inductive">even</span></a> 0<br/>
| <a id="even_SS" class="idref" href="#even_SS"><span class="id" title="constructor">even_SS</span></a> : <span class="id" title="keyword">∀</span> <a id="n:237" class="idref" href="#n:237"><span class="id" title="binder">n</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>, <a class="idref" href="cpdt_notes.html#even:235"><span class="id" title="inductive">even</span></a> <a class="idref" href="cpdt_notes.html#n:237"><span class="id" title="variable">n</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#even:235"><span class="id" title="inductive">even</span></a> (<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> (<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="cpdt_notes.html#n:237"><span class="id" title="variable">n</span></a>))<br/>
.<br/>

<br/>
<span class="id" title="keyword">Theorem</span> <a id="even_0" class="idref" href="#even_0"><span class="id" title="lemma">even_0</span></a> : <a class="idref" href="cpdt_notes.html#even"><span class="id" title="inductive">even</span></a> 0.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Theorem</span> <a id="even_4" class="idref" href="#even_4"><span class="id" title="lemma">even_4</span></a> : <a class="idref" href="cpdt_notes.html#even"><span class="id" title="inductive">even</span></a> 4.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">constructor</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab20"></a><h2 class="section">Q: Automate <span class="inlinecode"><span class="id" title="var">even</span></span> <span class="inlinecode">4</span></h2>

<div class="paragraph"> </div>


<div class="paragraph"> </div>

When the problem is just about applying constructors, <span class="inlinecode"><span class="id" title="tactic">auto</span></span> can do the job easily.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Hint Constructors</span> <a class="idref" href="cpdt_notes.html#even"><span class="id" title="inductive">even</span></a>.<br/>
<span class="id" title="keyword">Theorem</span> <a id="even_4'" class="idref" href="#even_4'"><span class="id" title="lemma">even_4'</span></a> : <a class="idref" href="cpdt_notes.html#even"><span class="id" title="inductive">even</span></a> 4.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab21"></a><h2 class="section">Q: prove <span class="inlinecode">¬<span class="id" title="var">even</span></span> <span class="inlinecode">1</span></h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Theorem</span> <a id="not_even_1" class="idref" href="#not_even_1"><span class="id" title="lemma">not_even_1</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">¬</span></a> <a class="idref" href="cpdt_notes.html#even"><span class="id" title="inductive">even</span></a> 1.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Theorem</span> <a id="not_even_1'" class="idref" href="#not_even_1'"><span class="id" title="lemma">not_even_1'</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">¬</span></a> <a class="idref" href="cpdt_notes.html#even"><span class="id" title="inductive">even</span></a> 1.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> 1.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab22"></a><h2 class="section">Q: Prove <span class="inlinecode">¬<span class="id" title="var">even</span></span> <span class="inlinecode">3</span>.</h2>

</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <a id="not_even_3" class="idref" href="#not_even_3"><span class="id" title="lemma">not_even_3</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">¬</span></a> <a class="idref" href="cpdt_notes.html#even"><span class="id" title="inductive">even</span></a> 3.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> 1.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>

<br/>
</div>

<div class="doc">
<a id="lab23"></a><h2 class="section">Q: Prove <span class="inlinecode">¬<span class="id" title="var">even_plus</span></span>. Why not trivial ?</h2>

<div class="paragraph"> </div>


<div class="paragraph"> </div>

It's not trivial because the inductive case tries <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode">(<span class="id" title="var">S</span></span> <span class="inlinecode"><span class="id" title="var">n</span>)</span>
While we'd prefer a pattern like <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode">(<span class="id" title="var">S</span></span> <span class="inlinecode">(<span class="id" title="var">S</span></span> <span class="inlinecode"><span class="id" title="var">n</span>))</span>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Theorem</span> <a id="even_plus" class="idref" href="#even_plus"><span class="id" title="lemma">even_plus</span></a> : <span class="id" title="keyword">∀</span> <a id="n:238" class="idref" href="#n:238"><span class="id" title="binder">n</span></a> <a id="m:239" class="idref" href="#m:239"><span class="id" title="binder">m</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>, <a class="idref" href="cpdt_notes.html#even"><span class="id" title="inductive">even</span></a> <a class="idref" href="cpdt_notes.html#n:238"><span class="id" title="variable">n</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#even"><span class="id" title="inductive">even</span></a> <a class="idref" href="cpdt_notes.html#m:239"><span class="id" title="variable">m</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#even"><span class="id" title="inductive">even</span></a> (<a class="idref" href="cpdt_notes.html#n:238"><span class="id" title="variable">n</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="cpdt_notes.html#m:239"><span class="id" title="variable">m</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">simpl</span>.<br/>
<span class="id" title="keyword">Abort</span>.<br/>

<br/>
<span class="id" title="keyword">Theorem</span> <a id="even_plus_2" class="idref" href="#even_plus_2"><span class="id" title="lemma">even_plus_2</span></a> : <span class="id" title="keyword">∀</span> <a id="n:240" class="idref" href="#n:240"><span class="id" title="binder">n</span></a> <a id="m:241" class="idref" href="#m:241"><span class="id" title="binder">m</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>, <a class="idref" href="cpdt_notes.html#even"><span class="id" title="inductive">even</span></a> <a class="idref" href="cpdt_notes.html#n:240"><span class="id" title="variable">n</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#even"><span class="id" title="inductive">even</span></a> <a class="idref" href="cpdt_notes.html#m:241"><span class="id" title="variable">m</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#even"><span class="id" title="inductive">even</span></a> (<a class="idref" href="cpdt_notes.html#n:240"><span class="id" title="variable">n</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="cpdt_notes.html#m:241"><span class="id" title="variable">m</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Abort</span>.<br/>

<br/>
</div>

<div class="doc">
Or better, since <span class="inlinecode"><span class="id" title="var">H</span></span> appears as the first hypothesis, we can do : <span class="inlinecode"><span class="id" title="tactic">induction</span></span> <span class="inlinecode">1</span>.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Theorem</span> <a id="even_plus_final" class="idref" href="#even_plus_final"><span class="id" title="lemma">even_plus_final</span></a> : <span class="id" title="keyword">∀</span> <a id="n:242" class="idref" href="#n:242"><span class="id" title="binder">n</span></a> <a id="m:243" class="idref" href="#m:243"><span class="id" title="binder">m</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>, <a class="idref" href="cpdt_notes.html#even"><span class="id" title="inductive">even</span></a> <a class="idref" href="cpdt_notes.html#n:242"><span class="id" title="variable">n</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#even"><span class="id" title="inductive">even</span></a> <a class="idref" href="cpdt_notes.html#m:243"><span class="id" title="variable">m</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#even"><span class="id" title="inductive">even</span></a> (<a class="idref" href="cpdt_notes.html#n:242"><span class="id" title="variable">n</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="cpdt_notes.html#m:243"><span class="id" title="variable">m</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> 1; <span class="id" title="var">crush</span>.<br/>
<span class="id" title="keyword">Abort</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab24"></a><h2 class="section">Q: Lesson learned ? Proving <span class="inlinecode"><span class="id" title="var">even_plus</span></span>.</h2>

<div class="paragraph"> </div>

 Instead of <span class="inlinecode"><span class="id" title="tactic">induction</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span>, use <span class="inlinecode"><span class="id" title="tactic">induction</span></span> <span class="inlinecode">(<span class="id" title="var">even</span></span> <span class="inlinecode"><span class="id" title="var">n</span>)</span>.
    It's called *rule induction* and very handy.

<div class="paragraph"> </div>

    Instead of pattern-matching over how <span class="inlinecode"><span class="id" title="var">n</span></span> was constructed.
    (with induction step linkin <span class="inlinecode"><span class="id" title="var">n</span></span> with <span class="inlinecode"><span class="id" title="var">n</span>+1</span>, not interesting.)
    We pattern-match over how <span class="inlinecode"><span class="id" title="var">even</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> was constructed.
    (with induction step linking <span class="inlinecode"><span class="id" title="var">n</span></span> with <span class="inlinecode"><span class="id" title="var">n</span>+2</span>, more fruitful.)

</div>
<div class="code">

<br/>
</div>

<div class="doc">
<a id="lab25"></a><h2 class="section">Q: Now prove <span class="inlinecode">¬<span class="id" title="var">even</span></span> <span class="inlinecode">(2*<span class="id" title="var">n</span></span> <span class="inlinecode">+</span> <span class="inlinecode">1)</span></h2>

<div class="paragraph"> </div>


<div class="paragraph"> </div>

We could try rule induction like before.
But with recursive predicates, <span class="inlinecode"><span class="id" title="tactic">induction</span></span> is weird sometimes.
If we try, we get stuck with empty hypotheses.
It's related to how <span class="inlinecode"><span class="id" title="tactic">induction</span></span> replaces <span class="inlinecode"><span class="id" title="var">S</span></span> <span class="inlinecode">(<span class="id" title="var">n</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">n</span>)</span> with a fresh variable internally.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Theorem</span> <a id="even_contra" class="idref" href="#even_contra"><span class="id" title="lemma">even_contra</span></a> : <span class="id" title="keyword">∀</span> <a id="n:244" class="idref" href="#n:244"><span class="id" title="binder">n</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>, <a class="idref" href="cpdt_notes.html#even"><span class="id" title="inductive">even</span></a> (<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> (<a class="idref" href="cpdt_notes.html#n:244"><span class="id" title="variable">n</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="cpdt_notes.html#n:244"><span class="id" title="variable">n</span></a>)) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#False"><span class="id" title="inductive">False</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">H</span>.<br/>
<span class="id" title="keyword">Abort</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="even_contra_1" class="idref" href="#even_contra_1"><span class="id" title="lemma">even_contra_1</span></a> : <span class="id" title="keyword">∀</span> <a id="n:245" class="idref" href="#n:245"><span class="id" title="binder">n</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>, <a class="idref" href="cpdt_notes.html#even"><span class="id" title="inductive">even</span></a> <a class="idref" href="cpdt_notes.html#n:245"><span class="id" title="variable">n</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">∀</span> <a id="x:246" class="idref" href="#x:246"><span class="id" title="binder">x</span></a>, <a class="idref" href="cpdt_notes.html#n:245"><span class="id" title="variable">n</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> (<a class="idref" href="cpdt_notes.html#x:246"><span class="id" title="variable">x</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="cpdt_notes.html#x:246"><span class="id" title="variable">x</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#False"><span class="id" title="inductive">False</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">x</span>. &nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">H</span>; <span class="id" title="var">crush</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">n</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">x</span>; <span class="id" title="var">crush</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">Nat.add_succ_r</span> <span class="id" title="tactic">in</span> ×.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">IHeven</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">IHeven</span> <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
We get stuck without <span class="inlinecode"><span class="id" title="tactic">generalize</span></span> <span class="inlinecode"><span class="id" title="tactic">dependent</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span>,
but once we generalize <span class="inlinecode"><span class="id" title="var">x</span></span>, the rest is just about rewrites and applies.
The two main parts are :
<ul class="doclist">
<li> rule induction

</li>
<li> removing the cases where <span class="inlinecode"><span class="id" title="var">n</span></span> or <span class="inlinecode"><span class="id" title="var">x</span></span> are zero (hence the <span class="inlinecode"><span class="id" title="tactic">destruct</span></span>s)

</li>
<li> Rewrite <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">S</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span>

</li>
</ul>

<div class="paragraph"> </div>

Hence a simplified version of our lemma below

<div class="paragraph"> </div>


</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a id="even_contra_lemma" class="idref" href="#even_contra_lemma"><span class="id" title="lemma">even_contra_lemma</span></a> : <span class="id" title="keyword">∀</span> <a id="n:247" class="idref" href="#n:247"><span class="id" title="binder">n</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>, <a class="idref" href="cpdt_notes.html#even"><span class="id" title="inductive">even</span></a> <a class="idref" href="cpdt_notes.html#n:247"><span class="id" title="variable">n</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">∀</span> <a id="x:248" class="idref" href="#x:248"><span class="id" title="binder">x</span></a>, <a class="idref" href="cpdt_notes.html#n:247"><span class="id" title="variable">n</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> (<a class="idref" href="cpdt_notes.html#x:248"><span class="id" title="variable">x</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="cpdt_notes.html#x:248"><span class="id" title="variable">x</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#False"><span class="id" title="inductive">False</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hint Rewrite</span> <span class="id" title="lemma">Nat.add_succ_r</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> 1; <span class="id" title="var">crush</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">n</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">x</span>; <span class="id" title="var">crush</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Next trick : instead of using introduced variable, which is unstable and error-prome
better pattern-match on the goal

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a id="even_contra_lemma_final" class="idref" href="#even_contra_lemma_final"><span class="id" title="lemma">even_contra_lemma_final</span></a> : <span class="id" title="keyword">∀</span> <a id="n:249" class="idref" href="#n:249"><span class="id" title="binder">n</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>, <a class="idref" href="cpdt_notes.html#even"><span class="id" title="inductive">even</span></a> <a class="idref" href="cpdt_notes.html#n:249"><span class="id" title="variable">n</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">∀</span> <a id="x:250" class="idref" href="#x:250"><span class="id" title="binder">x</span></a>, <a class="idref" href="cpdt_notes.html#n:249"><span class="id" title="variable">n</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> (<a class="idref" href="cpdt_notes.html#x:250"><span class="id" title="variable">x</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="cpdt_notes.html#x:250"><span class="id" title="variable">x</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#False"><span class="id" title="inductive">False</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hint Rewrite</span> &lt;- <span class="id" title="lemma">Nat.add_succ_r</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> 1; <span class="id" title="var">crush</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> ?<span class="id" title="var">N</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> ?<span class="id" title="var">X</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> ?<span class="id" title="var">X</span> |- <span class="id" title="var">_</span> ] ⇒ <span class="id" title="tactic">destruct</span> <span class="id" title="var">N</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">X</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>; <span class="id" title="var">crush</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Now for the final theorem :

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a id="even_contra" class="idref" href="#even_contra"><span class="id" title="lemma">even_contra</span></a>: <span class="id" title="keyword">∀</span> <a id="n':251" class="idref" href="#n':251"><span class="id" title="binder">n'</span></a>, <a class="idref" href="cpdt_notes.html#even"><span class="id" title="inductive">even</span></a> <a class="idref" href="cpdt_notes.html#n':251"><span class="id" title="variable">n'</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">∀</span> <a id="n:252" class="idref" href="#n:252"><span class="id" title="binder">n</span></a>, <a class="idref" href="cpdt_notes.html#n':251"><span class="id" title="variable">n'</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> (<a class="idref" href="cpdt_notes.html#n:252"><span class="id" title="variable">n</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="cpdt_notes.html#n:252"><span class="id" title="variable">n</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#False"><span class="id" title="inductive">False</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<a class="idref" href="cpdt_notes.html#even_contra_lemma_final"><span class="id" title="lemma">even_contra_lemma_final</span></a> <span class="id" title="var">H</span> <span class="id" title="var">n</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Or more simply, use <span class="inlinecode"><span class="id" title="tactic">eapply</span></span> instead of <span class="inlinecode"><span class="id" title="tactic">apply</span></span> so you let the prover
find the right arguemnts for you.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a id="even_contra_final" class="idref" href="#even_contra_final"><span class="id" title="lemma">even_contra_final</span></a>: <span class="id" title="keyword">∀</span> <a id="n':253" class="idref" href="#n':253"><span class="id" title="binder">n'</span></a>, <a class="idref" href="cpdt_notes.html#even"><span class="id" title="inductive">even</span></a> <a class="idref" href="cpdt_notes.html#n':253"><span class="id" title="variable">n'</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">∀</span> <a id="n:254" class="idref" href="#n:254"><span class="id" title="binder">n</span></a>, <a class="idref" href="cpdt_notes.html#n':253"><span class="id" title="variable">n'</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> (<a class="idref" href="cpdt_notes.html#n:254"><span class="id" title="variable">n</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="cpdt_notes.html#n:254"><span class="id" title="variable">n</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#False"><span class="id" title="inductive">False</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">eapply</span> <a class="idref" href="cpdt_notes.html#even_contra_lemma_final"><span class="id" title="lemma">even_contra_lemma_final</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab26"></a><h2 class="section">Q: Lesson learned ? Proving <span class="inlinecode">¬<span class="id" title="var">even</span></span> <span class="inlinecode">(2<span class="id" title="var">n</span>+1)</span></h2>

<div class="paragraph"> </div>


<div class="paragraph"> </div>

Several tips :
<ul class="doclist">
<li> Rule induction is still a good advice.

</li>
<li> When <span class="inlinecode"><span class="id" title="tactic">induction</span></span> is lost, prove backwards through lemmas
  mentioning the expressions of interest

</li>
<li> Search rewrites with <span class="inlinecode"><span class="id" title="keyword">SearchRewrite</span></span>

</li>
<li> Help <span class="inlinecode"><span class="id" title="var">crush</span></span> with the appropriate <span class="inlinecode"><span class="id" title="keyword">Hint</span></span> <span class="inlinecode"><span class="id" title="keyword">Rewrite</span></span> <span class="inlinecode"><span class="id" title="var">xxx</span></span>

</li>
<li> When <span class="inlinecode"><span class="id" title="tactic">apply</span></span> doesn't find the instances, try <span class="inlinecode"><span class="id" title="tactic">eapply</span></span> instead.

</li>
</ul>

<div class="paragraph"> </div>


</div>
<div class="code">

<br/>
</div>

<div class="doc">
<a id="lab27"></a><h2 class="section">Q: What problem occurs when introducing variables to soon ?</h2>

<div class="paragraph"> </div>


<div class="paragraph"> </div>

Proof gets stuck because of of free variable that should be bound.
e.g.

<div class="paragraph"> </div>

<br/>
<span class="inlinecode"><span class="id" title="keyword">∀</span> <span class="id" title="var">n</span> <span class="id" title="var">x</span>: <span class="id" title="var">nat</span>, <span class="id" title="var">even</span> <span class="id" title="var">n</span> → <span class="id" title="var">n</span> = <span class="id" title="var">S</span> (<span class="id" title="var">x</span> + <span class="id" title="var">x</span>) → <span class="id" title="var">False</span>.
<div class="paragraph"> </div>

</span>Introducing <span class="inlinecode"><span class="id" title="var">x</span></span> too soon will specialize it before doing the induction.
So we'll want to <span class="inlinecode"><span class="id" title="tactic">generalize</span></span> it before calling <span class="inlinecode"><span class="id" title="tactic">induction</span></span>.
We'll have a stronger goal but a stronger inductive hypothesis,
which in genenral works better.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a id="even_contra_too_soon" class="idref" href="#even_contra_too_soon"><span class="id" title="lemma">even_contra_too_soon</span></a> : <span class="id" title="keyword">∀</span> <a id="n:255" class="idref" href="#n:255"><span class="id" title="binder">n</span></a> <a id="x:256" class="idref" href="#x:256"><span class="id" title="binder">x</span></a>: <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>, <a class="idref" href="cpdt_notes.html#even"><span class="id" title="inductive">even</span></a> <a class="idref" href="cpdt_notes.html#n:255"><span class="id" title="variable">n</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#n:255"><span class="id" title="variable">n</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> (<a class="idref" href="cpdt_notes.html#x:256"><span class="id" title="variable">x</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="cpdt_notes.html#x:256"><span class="id" title="variable">x</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#False"><span class="id" title="inductive">False</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hint Rewrite</span> &lt;- <span class="id" title="lemma">Nat.add_succ_r</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">H</span>; <span class="id" title="var">crush</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> ?<span class="id" title="var">N</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> ?<span class="id" title="var">X</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> ?<span class="id" title="var">X</span> |- <span class="id" title="var">_</span> ] ⇒ <span class="id" title="tactic">destruct</span> <span class="id" title="var">N</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">X</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>; <span class="id" title="var">crush</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab28"></a><h1 class="section">5 - Infinite Data and Proofs</h1>

</div>
<div class="code">

<br/>
</div>

<div class="doc">
<a id="lab29"></a><h2 class="section">Q: What will go wrong if we can define non-terminating functions ?</h2>

<div class="paragraph"> </div>


<div class="paragraph"> </div>

<ul class="doclist">
<li> You could define a proof of <span class="inlinecode"><span class="id" title="var">False</span></span>, breaking the logic.

</li>
<li> Tactics evaluating functions, like <span class="inlinecode"><span class="id" title="tactic">reflexivity</span></span>, could hang forever.

</li>
<li> Rocq couldn't determine whether the functions define would terminate
  (as it would be equivalent to the Halting problem, undecidable)

</li>
</ul>

<div class="paragraph"> </div>

 An example of proof of false we could build in that case : 
</div>
<div class="code">
<span class="id" title="var">Fail</span> <span class="id" title="keyword">Fixpoint</span> <a id="bad" class="idref" href="#bad"><span class="id" title="definition">bad</span></a> (<a id="u:257" class="idref" href="#u:257"><span class="id" title="binder">u</span></a> : <a class="idref" href="cpdt_notes.html#unit"><span class="id" title="inductive">unit</span></a>) : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#False"><span class="id" title="inductive">False</span></a> := <a class="idref" href="cpdt_notes.html#bad:258"><span class="id" title="definition">bad</span></a> <a class="idref" href="cpdt_notes.html#u:257"><span class="id" title="variable">u</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab30"></a><h2 class="section">Q: So how can we play with infinite lazy structures in Rocq ?</h2>

<div class="paragraph"> </div>

 With *coinductive types*, the subject of this chapter. 
</div>
<div class="code">

<br/>
</div>

<div class="doc">
<a id="lab31"></a><h1 class="section">5.1 - Computing with Infinite Data</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Section</span> <a id="Stream" class="idref" href="#Stream"><span class="id" title="section">Stream</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variable</span> <a id="Stream.A" class="idref" href="#Stream.A"><span class="id" title="variable">A</span></a> : <span class="id" title="keyword">Type</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab32"></a><h2 class="section">Q: Define streams (infinite lists).</h2>

</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">CoInductive</span> <a id="stream" class="idref" href="#stream"><span class="id" title="inductive">stream</span></a> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <a id="Cons" class="idref" href="#Cons"><span class="id" title="constructor">Cons</span></a> : <a class="idref" href="cpdt_notes.html#Stream.A"><span class="id" title="variable">A</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#stream:261"><span class="id" title="inductive">stream</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#stream:261"><span class="id" title="inductive">stream</span></a><br/>
&nbsp;&nbsp;.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="cpdt_notes.html#Stream"><span class="id" title="section">Stream</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab33"></a><h2 class="section">Q: Define the stream of zeroes.</h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">CoFixpoint</span> <a id="zeroes" class="idref" href="#zeroes"><span class="id" title="definition">zeroes</span></a> : <a class="idref" href="cpdt_notes.html#stream"><span class="id" title="inductive">stream</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> := <a class="idref" href="cpdt_notes.html#Cons"><span class="id" title="constructor">Cons</span></a> 0 <a class="idref" href="cpdt_notes.html#zeroes:263"><span class="id" title="definition">zeroes</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab34"></a><h2 class="section">Q: Define the stream of alternating true/false.</h2>

<div class="paragraph"> </div>

 A first tentative : 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">CoFixpoint</span> <a id="alt_true_false" class="idref" href="#alt_true_false"><span class="id" title="definition">alt_true_false</span></a> (<a id="b:264" class="idref" href="#b:264"><span class="id" title="binder">b</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a>) : <a class="idref" href="cpdt_notes.html#stream"><span class="id" title="inductive">stream</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a> := <br/>
&nbsp;&nbsp;<a class="idref" href="cpdt_notes.html#Cons"><span class="id" title="constructor">Cons</span></a> <a class="idref" href="cpdt_notes.html#b:264"><span class="id" title="variable">b</span></a> (<a class="idref" href="cpdt_notes.html#alt_true_false:265"><span class="id" title="definition">alt_true_false</span></a> (<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#negb"><span class="id" title="definition">negb</span></a> <a class="idref" href="cpdt_notes.html#b:264"><span class="id" title="variable">b</span></a>)).<br/>

<br/>
</div>

<div class="doc">
The problem is the input boolean <span class="inlinecode"><span class="id" title="var">b</span></span>,
    the idea of an infinite alternating list shouldn't ask for a boolean value.
    It means <span class="inlinecode"><span class="id" title="var">alt_true_false</span></span> <span class="inlinecode"><span class="id" title="var">true</span></span> and <span class="inlinecode"><span class="id" title="var">alt_true_false</span></span> <span class="inlinecode"><span class="id" title="var">false</span></span> should be the same object.
    So the boolean shouldn't be required at all.

<div class="paragraph"> </div>

    Below definition solves this problem. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">CoFixpoint</span> <a id="true_false" class="idref" href="#true_false"><span class="id" title="definition">true_false</span></a> : <a class="idref" href="cpdt_notes.html#stream"><span class="id" title="inductive">stream</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a> := <a class="idref" href="cpdt_notes.html#Cons"><span class="id" title="constructor">Cons</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="cpdt_notes.html#false_true:267"><span class="id" title="definition">false_true</span></a><br/>
<span class="id" title="keyword">with</span>       <a id="false_true" class="idref" href="#false_true"><span class="id" title="definition">false_true</span></a> : <a class="idref" href="cpdt_notes.html#stream"><span class="id" title="inductive">stream</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a> := <a class="idref" href="cpdt_notes.html#Cons"><span class="id" title="constructor">Cons</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="cpdt_notes.html#true_false:266"><span class="id" title="definition">true_false</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab35"></a><h2 class="section">Q: Write an <span class="inlinecode"><span class="id" title="var">approx</span></span> function to convert streams to lists.</h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <a id="approx" class="idref" href="#approx"><span class="id" title="definition">approx</span></a> (<a id="A:268" class="idref" href="#A:268"><span class="id" title="binder">A</span></a> : <span class="id" title="keyword">Type</span>) (<a id="s:269" class="idref" href="#s:269"><span class="id" title="binder">s</span></a> : <a class="idref" href="cpdt_notes.html#stream"><span class="id" title="inductive">stream</span></a> <a class="idref" href="cpdt_notes.html#A:268"><span class="id" title="variable">A</span></a>) (<a id="n:270" class="idref" href="#n:270"><span class="id" title="binder">n</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="cpdt_notes.html#A:268"><span class="id" title="variable">A</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="cpdt_notes.html#n:270"><span class="id" title="variable">n</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#O"><span class="id" title="constructor">O</span></a> ⇒ <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">n'</span> ⇒ (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="cpdt_notes.html#s:269"><span class="id" title="variable">s</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="cpdt_notes.html#Cons"><span class="id" title="constructor">Cons</span></a> <span class="id" title="var">h</span> <span class="id" title="var">t</span> ⇒ <span class="id" title="var">h</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">(</span></a><a class="idref" href="cpdt_notes.html#approx:271"><span class="id" title="definition">approx</span></a> <span class="id" title="var">t</span> <span class="id" title="var">n'</span><a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab36"></a><h2 class="section">Q: Sanity-check your definitions with some examples.</h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Eval</span> <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> (<a class="idref" href="cpdt_notes.html#approx"><span class="id" title="definition">approx</span></a> <a class="idref" href="cpdt_notes.html#zeroes"><span class="id" title="definition">zeroes</span></a> 10).<br/>

<br/>
<span class="id" title="keyword">Eval</span> <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> (<a class="idref" href="cpdt_notes.html#approx"><span class="id" title="definition">approx</span></a> <a class="idref" href="cpdt_notes.html#true_false"><span class="id" title="definition">true_false</span></a> 5).<br/>
<span class="id" title="keyword">Eval</span> <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> (<a class="idref" href="cpdt_notes.html#approx"><span class="id" title="definition">approx</span></a> <a class="idref" href="cpdt_notes.html#false_true"><span class="id" title="definition">false_true</span></a> 5).<br/>
<span class="id" title="keyword">Eval</span> <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> (<a class="idref" href="cpdt_notes.html#approx"><span class="id" title="definition">approx</span></a> <a class="idref" href="cpdt_notes.html#false_true"><span class="id" title="definition">false_true</span></a> 1).<br/>
<span class="id" title="keyword">Eval</span> <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> (<a class="idref" href="cpdt_notes.html#approx"><span class="id" title="definition">approx</span></a> <a class="idref" href="cpdt_notes.html#false_true"><span class="id" title="definition">false_true</span></a> 0).<br/>

<br/>
</div>

<div class="doc">
<a id="lab37"></a><h2 class="section">Q: Compare <span class="inlinecode"><span class="id" title="keyword">Fixpoint</span></span> and <span class="inlinecode"><span class="id" title="keyword">CoFixpoint</span></span>. Restrictions of both ?</h2>

<div class="paragraph"> </div>


<div class="paragraph"> </div>

<span class="inlinecode"><span class="id" title="keyword">Fixpoint</span></span> <i>consumes</i> values of inductive types,
and has restriction on its argument (which must decrease).
<span class="inlinecode"><span class="id" title="keyword">CoFixpoint</span></span> <i>produces</i> values of coinductive types,
and has restrictions on its return value (which must increase).

<div class="paragraph"> </div>

Below are dual example of forbidden looping fixpoint and cofixpoint.
<ul class="doclist">
<li> <span class="inlinecode"><span class="id" title="var">loop</span></span> is forbidden because its argument doesn't decrease.

</li>
<li> <span class="inlinecode"><span class="id" title="var">coloop</span></span> is forbidden because its return value doesn't increase.

</li>
</ul>

<div class="paragraph"> </div>


</div>
<div class="code">

<br/>
<span class="id" title="var">Fail</span> <span class="id" title="keyword">Fixpoint</span> <a id="loop" class="idref" href="#loop"><span class="id" title="definition">loop</span></a> (<a id="u:274" class="idref" href="#u:274"><span class="id" title="binder">u</span></a> : <a class="idref" href="cpdt_notes.html#unit"><span class="id" title="inductive">unit</span></a>) : <a class="idref" href="cpdt_notes.html#unit"><span class="id" title="inductive">unit</span></a> := <a class="idref" href="cpdt_notes.html#loop:275"><span class="id" title="definition">loop</span></a> <a class="idref" href="cpdt_notes.html#u:274"><span class="id" title="variable">u</span></a>.<br/>

<br/>
<span class="id" title="var">Fail</span> <span class="id" title="keyword">CoFixpoint</span> <a id="coloop" class="idref" href="#coloop"><span class="id" title="definition">coloop</span></a> (<a id="s:276" class="idref" href="#s:276"><span class="id" title="binder">s</span></a> : <a class="idref" href="cpdt_notes.html#stream"><span class="id" title="inductive">stream</span></a> <a class="idref" href="cpdt_notes.html#unit"><span class="id" title="inductive">unit</span></a>) : <a class="idref" href="cpdt_notes.html#stream"><span class="id" title="inductive">stream</span></a> <a class="idref" href="cpdt_notes.html#unit"><span class="id" title="inductive">unit</span></a> := <a class="idref" href="cpdt_notes.html#coloop:277"><span class="id" title="definition">coloop</span></a> <a class="idref" href="cpdt_notes.html#s:276"><span class="id" title="variable">s</span></a>.<br/>

<br/>
</div>

<div class="doc">
If <span class="inlinecode"><span class="id" title="var">coloop</span></span> weren't guarded, our <span class="inlinecode"><span class="id" title="var">approx</span></span> function could have run forever. 
</div>
<div class="code">

<br/>
</div>

<div class="doc">
<a id="lab38"></a><h2 class="section">Q: Write a <span class="inlinecode"><span class="id" title="var">map</span></span> function over <span class="inlinecode"><span class="id" title="var">stream</span></span>s.</h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Section</span> <a id="stream_map" class="idref" href="#stream_map"><span class="id" title="section">stream_map</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variables</span> <a id="stream_map.A" class="idref" href="#stream_map.A"><span class="id" title="variable">A</span></a> <a id="stream_map.B" class="idref" href="#stream_map.B"><span class="id" title="variable">B</span></a> : <span class="id" title="keyword">Type</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">CoFixpoint</span> <a id="stream_map" class="idref" href="#stream_map"><span class="id" title="definition">stream_map</span></a> (<a id="f:282" class="idref" href="#f:282"><span class="id" title="binder">f</span></a> : <a class="idref" href="cpdt_notes.html#stream_map.A"><span class="id" title="variable">A</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#stream_map.B"><span class="id" title="variable">B</span></a>) (<a id="s:283" class="idref" href="#s:283"><span class="id" title="binder">s</span></a> : <a class="idref" href="cpdt_notes.html#stream"><span class="id" title="inductive">stream</span></a> <a class="idref" href="cpdt_notes.html#stream_map.A"><span class="id" title="variable">A</span></a>) : <a class="idref" href="cpdt_notes.html#stream"><span class="id" title="inductive">stream</span></a> <a class="idref" href="cpdt_notes.html#stream_map.B"><span class="id" title="variable">B</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="cpdt_notes.html#s:283"><span class="id" title="variable">s</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="cpdt_notes.html#Cons"><span class="id" title="constructor">Cons</span></a> <span class="id" title="var">h</span> <span class="id" title="var">t</span> ⇒ <a class="idref" href="cpdt_notes.html#Cons"><span class="id" title="constructor">Cons</span></a> (<a class="idref" href="cpdt_notes.html#f:282"><span class="id" title="variable">f</span></a> <span class="id" title="var">h</span>) (<a class="idref" href="cpdt_notes.html#stream_map:284"><span class="id" title="definition">stream_map</span></a> <a class="idref" href="cpdt_notes.html#f:282"><span class="id" title="variable">f</span></a> <span class="id" title="var">t</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="cpdt_notes.html#stream_map"><span class="id" title="section">stream_map</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab39"></a><h2 class="section">Q: Example of classic function that does have its dual ?</h2>

<div class="paragraph"> </div>

 The <span class="inlinecode"><span class="id" title="var">filter</span></span> function can't have a cofixpoint dual.
    Indeed, if the filter rejects every element in the stream,
    it cannot satisfy the guardedness condition.
    Running <span class="inlinecode"><span class="id" title="var">filter</span></span> with such an all-rejecting filter will hang forever. 
</div>
<div class="code">

<br/>
</div>

<div class="doc">
<a id="lab40"></a><h2 class="section">Q: More subtle example violating guardedness condition ?</h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Section</span> <a id="interleave" class="idref" href="#interleave"><span class="id" title="section">interleave</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variables</span> <a id="interleave.A" class="idref" href="#interleave.A"><span class="id" title="variable">A</span></a> : <span class="id" title="keyword">Type</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">CoFixpoint</span> <a id="interleave" class="idref" href="#interleave"><span class="id" title="definition">interleave</span></a> (<a id="s1:288" class="idref" href="#s1:288"><span class="id" title="binder">s1</span></a> <a id="s2:289" class="idref" href="#s2:289"><span class="id" title="binder">s2</span></a> : <a class="idref" href="cpdt_notes.html#stream"><span class="id" title="inductive">stream</span></a> <a class="idref" href="cpdt_notes.html#interleave.A"><span class="id" title="variable">A</span></a>) : <a class="idref" href="cpdt_notes.html#stream"><span class="id" title="inductive">stream</span></a> <a class="idref" href="cpdt_notes.html#interleave.A"><span class="id" title="variable">A</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="cpdt_notes.html#s1:288"><span class="id" title="variable">s1</span></a>, <a class="idref" href="cpdt_notes.html#s2:289"><span class="id" title="variable">s2</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="cpdt_notes.html#Cons"><span class="id" title="constructor">Cons</span></a> <span class="id" title="var">h1</span> <span class="id" title="var">t1</span>, <a class="idref" href="cpdt_notes.html#Cons"><span class="id" title="constructor">Cons</span></a> <span class="id" title="var">h2</span> <span class="id" title="var">t2</span> ⇒ <a class="idref" href="cpdt_notes.html#Cons"><span class="id" title="constructor">Cons</span></a> <span class="id" title="var">h1</span> (<a class="idref" href="cpdt_notes.html#Cons"><span class="id" title="constructor">Cons</span></a> <span class="id" title="var">h2</span> (<a class="idref" href="cpdt_notes.html#interleave:290"><span class="id" title="definition">interleave</span></a> <span class="id" title="var">t1</span> <span class="id" title="var">t2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="cpdt_notes.html#interleave"><span class="id" title="section">interleave</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="map'" class="idref" href="#map'"><span class="id" title="section">map'</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variables</span> <a id="map'.A" class="idref" href="#map'.A"><span class="id" title="variable">A</span></a> <a id="map'.B" class="idref" href="#map'.B"><span class="id" title="variable">B</span></a> : <span class="id" title="keyword">Type</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variables</span> <a id="map'.f" class="idref" href="#map'.f"><span class="id" title="variable">f</span></a> : <a class="idref" href="cpdt_notes.html#map'.A"><span class="id" title="variable">A</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#map'.B"><span class="id" title="variable">B</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="var">Fail</span> <span class="id" title="keyword">CoFixpoint</span> <a id="map'" class="idref" href="#map'"><span class="id" title="definition">map'</span></a> (<a id="s:299" class="idref" href="#s:299"><span class="id" title="binder">s</span></a> : <a class="idref" href="cpdt_notes.html#stream"><span class="id" title="inductive">stream</span></a> <a class="idref" href="cpdt_notes.html#map'.A"><span class="id" title="variable">A</span></a>) : <a class="idref" href="cpdt_notes.html#stream"><span class="id" title="inductive">stream</span></a> <a class="idref" href="cpdt_notes.html#map'.B"><span class="id" title="variable">B</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="cpdt_notes.html#s:299"><span class="id" title="variable">s</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="cpdt_notes.html#Cons"><span class="id" title="constructor">Cons</span></a> <span class="id" title="var">h</span> <span class="id" title="var">t</span> ⇒ <a class="idref" href="cpdt_notes.html#interleave"><span class="id" title="definition">interleave</span></a> (<a class="idref" href="cpdt_notes.html#Cons"><span class="id" title="constructor">Cons</span></a> (<a class="idref" href="cpdt_notes.html#map'.f"><span class="id" title="variable">f</span></a> <span class="id" title="var">h</span>) (<a class="idref" href="cpdt_notes.html#map':300"><span class="id" title="definition">map'</span></a> <span class="id" title="var">t</span>)) (<a class="idref" href="cpdt_notes.html#Cons"><span class="id" title="constructor">Cons</span></a> (<a class="idref" href="cpdt_notes.html#map'.f"><span class="id" title="variable">f</span></a> <span class="id" title="var">h</span>) (<a class="idref" href="cpdt_notes.html#map':300"><span class="id" title="definition">map'</span></a> <span class="id" title="var">t</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="cpdt_notes.html#map'"><span class="id" title="section">map'</span></a>.<br/>

<br/>
</div>

<div class="doc">
Rocq will reject definitions when it can't ensure the <i>productivity</i> condition. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a id="tail'" class="idref" href="#tail'"><span class="id" title="definition">tail'</span></a> (<a id="s:302" class="idref" href="#s:302"><span class="id" title="binder">s</span></a> : <a class="idref" href="cpdt_notes.html#stream"><span class="id" title="inductive">stream</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) : <a class="idref" href="cpdt_notes.html#stream"><span class="id" title="inductive">stream</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="cpdt_notes.html#s:302"><span class="id" title="variable">s</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="cpdt_notes.html#Cons"><span class="id" title="constructor">Cons</span></a> <span class="id" title="var">_</span> <span class="id" title="var">t</span> ⇒ <span class="id" title="var">t</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="var">Fail</span> <span class="id" title="keyword">CoFixpoint</span> <a id="bad" class="idref" href="#bad"><span class="id" title="definition">bad</span></a> : <a class="idref" href="cpdt_notes.html#stream"><span class="id" title="inductive">stream</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> := <a class="idref" href="cpdt_notes.html#tail'"><span class="id" title="definition">tail'</span></a> (<a class="idref" href="cpdt_notes.html#Cons"><span class="id" title="constructor">Cons</span></a> 0 <a class="idref" href="cpdt_notes.html#bad:304"><span class="id" title="definition">bad</span></a>).<br/>

<br/>
</div>

<div class="doc">
Here the return value doesn't grow, because the additional constructor
    is then removed by the sneaky <span class="inlinecode"><span class="id" title="var">tail'</span></span> function, so the net progress is zero.
    In that case, we would have just defined an infinite loop, breaking Rocq.

<div class="paragraph"> </div>

    To ensure the return value grows,  Rocq not only demands a constructor,
    but demands that everything touching the return value is harmless (not shrinking).
    So functions are forbidden. Only constructors, and <span class="inlinecode"><span class="id" title="keyword">fun</span></span>, <span class="inlinecode"><span class="id" title="keyword">match</span></span> blocs.

<div class="paragraph"> </div>

    &gt; No shrinking stuffs !

<div class="paragraph"> </div>

    
</div>
<div class="code">

<br/>
</div>

<div class="doc">
<a id="lab41"></a><h1 class="section">5.2 - Infinite Proofs</h1>

</div>
<div class="code">

<br/>
</div>

<div class="doc">
<a id="lab42"></a><h2 class="section">Q: Give example of 2 equal streams, and prove them equal.</h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">CoFixpoint</span> <a id="all_ones_a" class="idref" href="#all_ones_a"><span class="id" title="definition">all_ones_a</span></a> : <a class="idref" href="cpdt_notes.html#stream"><span class="id" title="inductive">stream</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> := <a class="idref" href="cpdt_notes.html#Cons"><span class="id" title="constructor">Cons</span></a> 1 <a class="idref" href="cpdt_notes.html#all_ones_a:305"><span class="id" title="definition">all_ones_a</span></a>.<br/>
<span class="id" title="keyword">Definition</span> <a id="all_ones_b" class="idref" href="#all_ones_b"><span class="id" title="definition">all_ones_b</span></a> : <a class="idref" href="cpdt_notes.html#stream"><span class="id" title="inductive">stream</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> := <a class="idref" href="cpdt_notes.html#stream_map"><span class="id" title="definition">stream_map</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="cpdt_notes.html#zeroes"><span class="id" title="definition">zeroes</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="stream_eq" class="idref" href="#stream_eq"><span class="id" title="section">stream_eq</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variables</span> <a id="stream_eq.A" class="idref" href="#stream_eq.A"><span class="id" title="variable">A</span></a> : <span class="id" title="keyword">Type</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">CoInductive</span> <a id="stream_eq" class="idref" href="#stream_eq"><span class="id" title="inductive">stream_eq</span></a> : <a class="idref" href="cpdt_notes.html#stream"><span class="id" title="inductive">stream</span></a> <a class="idref" href="cpdt_notes.html#stream_eq.A"><span class="id" title="variable">A</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#stream"><span class="id" title="inductive">stream</span></a> <a class="idref" href="cpdt_notes.html#stream_eq.A"><span class="id" title="variable">A</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> := <br/>
&nbsp;&nbsp;| <a id="Stream_Eq" class="idref" href="#Stream_Eq"><span class="id" title="constructor">Stream_Eq</span></a> : <span class="id" title="keyword">∀</span> <a id="h:310" class="idref" href="#h:310"><span class="id" title="binder">h</span></a> <a id="t1:311" class="idref" href="#t1:311"><span class="id" title="binder">t1</span></a> <a id="t2:312" class="idref" href="#t2:312"><span class="id" title="binder">t2</span></a>, <a class="idref" href="cpdt_notes.html#stream_eq:308"><span class="id" title="inductive">stream_eq</span></a> <a class="idref" href="cpdt_notes.html#t1:311"><span class="id" title="variable">t1</span></a> <a class="idref" href="cpdt_notes.html#t2:312"><span class="id" title="variable">t2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#stream_eq:308"><span class="id" title="inductive">stream_eq</span></a> (<a class="idref" href="cpdt_notes.html#Cons"><span class="id" title="constructor">Cons</span></a> <a class="idref" href="cpdt_notes.html#h:310"><span class="id" title="variable">h</span></a> <a class="idref" href="cpdt_notes.html#t1:311"><span class="id" title="variable">t1</span></a>) (<a class="idref" href="cpdt_notes.html#Cons"><span class="id" title="constructor">Cons</span></a> <a class="idref" href="cpdt_notes.html#h:310"><span class="id" title="variable">h</span></a> <a class="idref" href="cpdt_notes.html#t2:312"><span class="id" title="variable">t2</span></a>)<br/>
&nbsp;&nbsp;.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="cpdt_notes.html#stream_eq"><span class="id" title="section">stream_eq</span></a>.<br/>

<br/>
<span class="id" title="keyword">Theorem</span> <a id="stream_a_eq_b_try1" class="idref" href="#stream_a_eq_b_try1"><span class="id" title="lemma">stream_a_eq_b_try1</span></a> : <a class="idref" href="cpdt_notes.html#stream_eq"><span class="id" title="inductive">stream_eq</span></a> <a class="idref" href="cpdt_notes.html#all_ones_a"><span class="id" title="definition">all_ones_a</span></a> <a class="idref" href="cpdt_notes.html#all_ones_b"><span class="id" title="definition">all_ones_b</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">cofix</span> <span class="id" title="var">stream_eq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">Fail</span> <span class="id" title="keyword">Guarded</span>.<br/>
<span class="id" title="keyword">Abort</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="frob" class="idref" href="#frob"><span class="id" title="definition">frob</span></a> <a id="A:313" class="idref" href="#A:313"><span class="id" title="binder">A</span></a> (<a id="s:314" class="idref" href="#s:314"><span class="id" title="binder">s</span></a> : <a class="idref" href="cpdt_notes.html#stream"><span class="id" title="inductive">stream</span></a> <a class="idref" href="cpdt_notes.html#A:313"><span class="id" title="variable">A</span></a>) : <a class="idref" href="cpdt_notes.html#stream"><span class="id" title="inductive">stream</span></a> <a class="idref" href="cpdt_notes.html#A:313"><span class="id" title="variable">A</span></a> :=<br/>
<span class="id" title="keyword">match</span> <a class="idref" href="cpdt_notes.html#s:314"><span class="id" title="variable">s</span></a> <span class="id" title="keyword">with</span><br/>
| <a class="idref" href="cpdt_notes.html#Cons"><span class="id" title="constructor">Cons</span></a> <span class="id" title="var">h</span> <span class="id" title="var">t</span> ⇒ <a class="idref" href="cpdt_notes.html#Cons"><span class="id" title="constructor">Cons</span></a> <span class="id" title="var">h</span> <span class="id" title="var">t</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="frob_eq" class="idref" href="#frob_eq"><span class="id" title="lemma">frob_eq</span></a> : <span class="id" title="keyword">∀</span> <a id="A:316" class="idref" href="#A:316"><span class="id" title="binder">A</span></a>, <span class="id" title="keyword">∀</span> (<a id="s:317" class="idref" href="#s:317"><span class="id" title="binder">s</span></a> : <a class="idref" href="cpdt_notes.html#stream"><span class="id" title="inductive">stream</span></a> <a class="idref" href="cpdt_notes.html#A:316"><span class="id" title="variable">A</span></a>), <a class="idref" href="cpdt_notes.html#frob"><span class="id" title="definition">frob</span></a> <a class="idref" href="cpdt_notes.html#s:317"><span class="id" title="variable">s</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="cpdt_notes.html#s:317"><span class="id" title="variable">s</span></a>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">s</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Theorem</span> <a id="stream_a_eq_b_try2" class="idref" href="#stream_a_eq_b_try2"><span class="id" title="lemma">stream_a_eq_b_try2</span></a> : <a class="idref" href="cpdt_notes.html#stream_eq"><span class="id" title="inductive">stream_eq</span></a> <a class="idref" href="cpdt_notes.html#all_ones_a"><span class="id" title="definition">all_ones_a</span></a> <a class="idref" href="cpdt_notes.html#all_ones_b"><span class="id" title="definition">all_ones_b</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">cofix</span> <span class="id" title="var">stream_eq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- (<a class="idref" href="cpdt_notes.html#frob_eq"><span class="id" title="lemma">frob_eq</span></a> <a class="idref" href="cpdt_notes.html#all_ones_a"><span class="id" title="definition">all_ones_a</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- (<a class="idref" href="cpdt_notes.html#frob_eq"><span class="id" title="lemma">frob_eq</span></a> <a class="idref" href="cpdt_notes.html#all_ones_b"><span class="id" title="definition">all_ones_b</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="cpdt_notes.html#frob"><span class="id" title="definition">frob</span></a> <span class="id" title="tactic">in</span> ×.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Guarded</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab43"></a><h2 class="section">Q: APARTE : Print and explain the generated proof term <span class="inlinecode"><span class="id" title="var">stream_a_eq_b_try2</span></span></h2>

<div class="paragraph"> </div>

 Destructuring the generated proof term : 

<div class="paragraph"> </div>

<pre>
Print stream_a_eq_b_try2.

Check eq_ind.
(A : Type)         1. A            
(x : A)            2. x            
(P : A -&gt; Prop),   3. P            
P x -&gt;             4. P x          
forall y : A,      5. y            
x = y              6. x = y        
-&gt; P y             result : P y    


Definition stream_a_eq_b_try2' :=
  cofix stream_eq : stream_eq all_ones_a all_ones_b :=
    eq_ind
--- 2. x ---------------------- i.e.  big_a ------------------------------------
      (frob all_ones_a)   
--- 3. P ---------------------- i.e.  s= b -------------------------------------
      (fun s : stream nat =&gt; cpdt_notes.stream_eq s all_ones_b) 
--- 4. P x -------------------- i.e.  big_a  s=  b -----------------------------
      (eq_ind
-------- 2. x ------ i.e. big_b  -----------------------------------------------
          (frob all_ones_b)
-------- 3. P ------ i.e. s= big_a ---------------------------------------------
          (fun s : stream nat =&gt; cpdt_notes.stream_eq (frob all_ones_a) s)
-------- 4. P x ---- i.e. big_b s= big_a ---------------------------------------
          (
            (
              Stream_Eq 1 stream_eq
              
              : cpdt_notes.stream_eq
                 ( match all_ones_a with | Cons h t =&gt; Cons h t end )
                 ( match all_ones_b with | Cons h t =&gt; Cons h t end )
              : cpdt_notes.stream_eq (frob all_ones_a) (frob all_ones_b)
            )
        
---------- 5. y ----- i.e.  b --------------------------------------------------
        all_ones_b
---------- 6. x = y - i.e. big_b = b -------------------------------------------
        (frob_eq all_ones_b)
      )
-------- res  : P y   i.e.  b s= big_a  ----------------------------------------

--- 5. y ----------------------- i.e.  a ---------------------------------------
      all_ones_a  
--- 6. x == y ------------------ i.e.  big_a = a -------------------------------
      (frob_eq all_ones_a)
--- res ------------------------ i.e   a s= b ----------------------------------
  : stream_eq all_ones_a all_ones_b
</pre>

<div class="paragraph"> </div>


</div>
<div class="code">

<br/>
</div>

<div class="doc">
<a id="lab44"></a><h2 class="section">Q: Proof v2 : Define a coinduction principle</h2>

                    to prove stream equality, and use it. 
<div class="paragraph"> </div>

 Now let's do better.
Instad of the boilerplate of magic but painful <span class="inlinecode"><span class="id" title="var">frob</span></span>,
let's try to arrive at a <span class="inlinecode"><span class="id" title="tactic">induction</span></span> <span class="inlinecode"><span class="id" title="var">x</span>;</span> <span class="inlinecode"><span class="id" title="var">crush</span>.</span> style of proof.

<div class="paragraph"> </div>

And to do so, we'll start by defining a coinductive principle for stream eq.

<div class="paragraph"> </div>


</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a id="hd" class="idref" href="#hd"><span class="id" title="definition">hd</span></a> <a id="A:318" class="idref" href="#A:318"><span class="id" title="binder">A</span></a> (<a id="s:319" class="idref" href="#s:319"><span class="id" title="binder">s</span></a> : <a class="idref" href="cpdt_notes.html#stream"><span class="id" title="inductive">stream</span></a> <a class="idref" href="cpdt_notes.html#A:318"><span class="id" title="variable">A</span></a>) : <a class="idref" href="cpdt_notes.html#A:318"><span class="id" title="variable">A</span></a> :=<br/>
<span class="id" title="keyword">match</span> <a class="idref" href="cpdt_notes.html#s:319"><span class="id" title="variable">s</span></a> <span class="id" title="keyword">with</span><br/>
| <a class="idref" href="cpdt_notes.html#Cons"><span class="id" title="constructor">Cons</span></a> <span class="id" title="var">h</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">h</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="tl" class="idref" href="#tl"><span class="id" title="definition">tl</span></a> <a id="A:321" class="idref" href="#A:321"><span class="id" title="binder">A</span></a> (<a id="s:322" class="idref" href="#s:322"><span class="id" title="binder">s</span></a> : <a class="idref" href="cpdt_notes.html#stream"><span class="id" title="inductive">stream</span></a> <a class="idref" href="cpdt_notes.html#A:321"><span class="id" title="variable">A</span></a>) : <a class="idref" href="cpdt_notes.html#stream"><span class="id" title="inductive">stream</span></a> <a class="idref" href="cpdt_notes.html#A:321"><span class="id" title="variable">A</span></a> :=<br/>
<span class="id" title="keyword">match</span> <a class="idref" href="cpdt_notes.html#s:322"><span class="id" title="variable">s</span></a> <span class="id" title="keyword">with</span><br/>
| <a class="idref" href="cpdt_notes.html#Cons"><span class="id" title="constructor">Cons</span></a> <span class="id" title="var">_</span> <span class="id" title="var">t</span> ⇒ <span class="id" title="var">t</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="stream_eq_coind" class="idref" href="#stream_eq_coind"><span class="id" title="section">stream_eq_coind</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variables</span> <a id="stream_eq_coind.A" class="idref" href="#stream_eq_coind.A"><span class="id" title="variable">A</span></a> : <span class="id" title="keyword">Type</span>.<br/>

<br/>
</div>

<div class="doc">
Define a relation <span class="inlinecode"><span class="id" title="var">R</span></span> that will represent our property (here stream equality) 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Variables</span> <a id="stream_eq_coind.R" class="idref" href="#stream_eq_coind.R"><span class="id" title="variable">R</span></a> : <a class="idref" href="cpdt_notes.html#stream"><span class="id" title="inductive">stream</span></a> <a class="idref" href="cpdt_notes.html#stream_eq_coind.A"><span class="id" title="variable">A</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#stream"><span class="id" title="inductive">stream</span></a> <a class="idref" href="cpdt_notes.html#stream_eq_coind.A"><span class="id" title="variable">A</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span>.<br/>

<br/>
</div>

<div class="doc">
Define all that must be true for the property to hold (here equality of heads,
      and passing-on the R-ness to the tail) 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Hypothesis</span> <a id="stream_eq_coind.Cons_case_hd" class="idref" href="#stream_eq_coind.Cons_case_hd"><span class="id" title="variable">Cons_case_hd</span></a> : <span class="id" title="keyword">∀</span> <a id="s1:328" class="idref" href="#s1:328"><span class="id" title="binder">s1</span></a> <a id="s2:329" class="idref" href="#s2:329"><span class="id" title="binder">s2</span></a>, <a class="idref" href="cpdt_notes.html#stream_eq_coind.R"><span class="id" title="variable">R</span></a> <a class="idref" href="cpdt_notes.html#s1:328"><span class="id" title="variable">s1</span></a> <a class="idref" href="cpdt_notes.html#s2:329"><span class="id" title="variable">s2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#hd"><span class="id" title="definition">hd</span></a> <a class="idref" href="cpdt_notes.html#s1:328"><span class="id" title="variable">s1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="cpdt_notes.html#hd"><span class="id" title="definition">hd</span></a> <a class="idref" href="cpdt_notes.html#s2:329"><span class="id" title="variable">s2</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hypothesis</span> <a id="stream_eq_coind.Cons_case_tl" class="idref" href="#stream_eq_coind.Cons_case_tl"><span class="id" title="variable">Cons_case_tl</span></a> : <span class="id" title="keyword">∀</span> <a id="s1:332" class="idref" href="#s1:332"><span class="id" title="binder">s1</span></a> <a id="s2:333" class="idref" href="#s2:333"><span class="id" title="binder">s2</span></a>, <a class="idref" href="cpdt_notes.html#stream_eq_coind.R"><span class="id" title="variable">R</span></a> <a class="idref" href="cpdt_notes.html#s1:332"><span class="id" title="variable">s1</span></a> <a class="idref" href="cpdt_notes.html#s2:333"><span class="id" title="variable">s2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#stream_eq_coind.R"><span class="id" title="variable">R</span></a> (<a class="idref" href="cpdt_notes.html#tl"><span class="id" title="definition">tl</span></a> <a class="idref" href="cpdt_notes.html#s1:332"><span class="id" title="variable">s1</span></a>) (<a class="idref" href="cpdt_notes.html#tl"><span class="id" title="definition">tl</span></a> <a class="idref" href="cpdt_notes.html#s2:333"><span class="id" title="variable">s2</span></a>).<br/>

<br/>
</div>

<div class="doc">
Now prove that this <span class="inlinecode"><span class="id" title="var">R</span></span> relation satisfies stream equality 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <a id="stream_eq_coind" class="idref" href="#stream_eq_coind"><span class="id" title="lemma">stream_eq_coind</span></a> : <span class="id" title="keyword">∀</span> <a id="s1:336" class="idref" href="#s1:336"><span class="id" title="binder">s1</span></a> <a id="s2:337" class="idref" href="#s2:337"><span class="id" title="binder">s2</span></a>, <a class="idref" href="cpdt_notes.html#stream_eq_coind.R"><span class="id" title="variable">R</span></a> <a class="idref" href="cpdt_notes.html#s1:336"><span class="id" title="variable">s1</span></a> <a class="idref" href="cpdt_notes.html#s2:337"><span class="id" title="variable">s2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#stream_eq"><span class="id" title="inductive">stream_eq</span></a> <a class="idref" href="cpdt_notes.html#s1:336"><span class="id" title="variable">s1</span></a> <a class="idref" href="cpdt_notes.html#s2:337"><span class="id" title="variable">s2</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">cofix</span> <span class="id" title="var">stream_eq_coind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>

<br/>
</div>

<div class="doc">
Nice trick to get equality of both heads (a = a0) 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">s1</span>, <span class="id" title="var">s2</span>. <span class="id" title="tactic">generalize</span> (<a class="idref" href="cpdt_notes.html#stream_eq_coind.Cons_case_hd"><span class="id" title="variable">Cons_case_hd</span></a> <span class="id" title="var">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heq</span> <span class="id" title="tactic">in</span> ×.<br/>
</div>

<div class="doc">
Moving 1 coinductive step forward 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>.<br/>
</div>

<div class="doc">
Now we've move forward one step, we can apply the co-inductive hypothesis. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">stream_eq_coind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<a class="idref" href="cpdt_notes.html#stream_eq_coind.Cons_case_tl"><span class="id" title="variable">Cons_case_tl</span></a> <span class="id" title="var">H</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Guarded</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Print</span> <span class="id" title="var">stream_eq_coind</span>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="cpdt_notes.html#stream_eq_coind"><span class="id" title="section">stream_eq_coind</span></a>.<br/>

<br/>
</div>

<div class="doc">
Now any predicates that satisfies
    <span class="inlinecode"><span class="id" title="var">Cons_case_hd</span></span> and <span class="inlinecode"><span class="id" title="var">Cons_case_tl</span></span> will do the job.  
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Theorem</span> <a id="stream_a_eq_b_try3" class="idref" href="#stream_a_eq_b_try3"><span class="id" title="lemma">stream_a_eq_b_try3</span></a> : <a class="idref" href="cpdt_notes.html#stream_eq"><span class="id" title="inductive">stream_eq</span></a> <a class="idref" href="cpdt_notes.html#all_ones_a"><span class="id" title="definition">all_ones_a</span></a> <a class="idref" href="cpdt_notes.html#all_ones_b"><span class="id" title="definition">all_ones_b</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<a class="idref" href="cpdt_notes.html#stream_eq_coind"><span class="id" title="lemma">stream_eq_coind</span></a>(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="s1:338" class="idref" href="#s1:338"><span class="id" title="binder"><span id="s1:340" class="id">s1</span></span></a> <a id="s2:339" class="idref" href="#s2:339"><span class="id" title="binder"><span id="s2:341" class="id">s2</span></span></a> ⇒ <a class="idref" href="cpdt_notes.html#s1:338"><span class="id" title="variable">s1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="cpdt_notes.html#all_ones_a"><span class="id" title="definition">all_ones_a</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="cpdt_notes.html#s2:339"><span class="id" title="variable">s2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="cpdt_notes.html#all_ones_b"><span class="id" title="definition">all_ones_b</span></a>)); <span class="id" title="var">crush</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab45"></a><h2 class="section">Q: APARTE : Illustrate the 'copy/paste' from <span class="inlinecode"><span class="id" title="var">stream_eq</span></span> to <span class="inlinecode"><span class="id" title="var">stream_eq_coind</span></span>.</h2>

<div class="paragraph"> </div>


<div class="paragraph"> </div>

It was not clear to me how the hypotheses of the coinductive principle
derive immediately from the arguments of the constructor in the coinductive type definition.
i.e. you take the arguments of <span class="inlinecode"><span class="id" title="var">Stream_Eq</span></span> and you get your hypotheses for <span class="inlinecode"><span class="id" title="var">stream_eq_coind</span></span>.

<div class="paragraph"> </div>

It was not clear because <span class="inlinecode"><span class="id" title="var">stream_eq</span></span> talks in <span class="inlinecode"><span class="id" title="var">s1</span></span> and <span class="inlinecode"><span class="id" title="var">s2</span></span>, and cleverly uses a single <span class="inlinecode"><span class="id" title="var">h</span></span>
to force equality of heads,

<div class="paragraph"> </div>

while <span class="inlinecode"><span class="id" title="var">stream_eq_coind</span></span> talks in <span class="inlinecode"><span class="id" title="var">h1</span></span>/<span class="inlinecode"><span class="id" title="var">t1</span></span> and <span class="inlinecode"><span class="id" title="var">h2</span></span>/<span class="inlinecode"><span class="id" title="var">t2</span></span>.

<div class="paragraph"> </div>

But we can remove this clever compactness and rewrite <span class="inlinecode"><span class="id" title="var">stream_eq</span></span> as below.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Section</span> <a id="stream_eq_raw" class="idref" href="#stream_eq_raw"><span class="id" title="section">stream_eq_raw</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variables</span> <a id="stream_eq_raw.A" class="idref" href="#stream_eq_raw.A"><span class="id" title="variable">A</span></a> : <span class="id" title="keyword">Type</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">CoInductive</span> <a id="stream_eq_raw" class="idref" href="#stream_eq_raw"><span class="id" title="inductive">stream_eq_raw</span></a> : <a class="idref" href="cpdt_notes.html#stream"><span class="id" title="inductive">stream</span></a> <a class="idref" href="cpdt_notes.html#stream_eq_raw.A"><span class="id" title="variable">A</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#stream"><span class="id" title="inductive">stream</span></a> <a class="idref" href="cpdt_notes.html#stream_eq_raw.A"><span class="id" title="variable">A</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> := <br/>
</div>

<div class="doc">
First way (and only) to build a proof of <span class="inlinecode"><span class="id" title="var">stream_eq</span></span> <span class="inlinecode"><span class="id" title="var">s1</span></span> <span class="inlinecode"><span class="id" title="var">s2</span></span> 
</div>
<div class="code">
&nbsp;&nbsp;| <a id="Stream_Eq'" class="idref" href="#Stream_Eq'"><span class="id" title="constructor">Stream_Eq'</span></a> : <span class="id" title="keyword">∀</span> <a id="s1:346" class="idref" href="#s1:346"><span class="id" title="binder">s1</span></a> <a id="s2:347" class="idref" href="#s2:347"><span class="id" title="binder">s2</span></a>,         <br/>
</div>

<div class="doc">
Precond 1 : equality of heads 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="cpdt_notes.html#hd"><span class="id" title="definition">hd</span></a> <a class="idref" href="cpdt_notes.html#s1:346"><span class="id" title="variable">s1</span></a><a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="cpdt_notes.html#hd"><span class="id" title="definition">hd</span></a> <a class="idref" href="cpdt_notes.html#s2:347"><span class="id" title="variable">s2</span></a><a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a>             <br/>
</div>

<div class="doc">
Precond 2 : equality of tails 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="cpdt_notes.html#stream_eq_raw:344"><span class="id" title="inductive">stream_eq_raw</span></a> (<a class="idref" href="cpdt_notes.html#tl"><span class="id" title="definition">tl</span></a> <a class="idref" href="cpdt_notes.html#s1:346"><span class="id" title="variable">s1</span></a>) (<a class="idref" href="cpdt_notes.html#tl"><span class="id" title="definition">tl</span></a> <a class="idref" href="cpdt_notes.html#s2:347"><span class="id" title="variable">s2</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <br/>
</div>

<div class="doc">
The result : equality of streams, our <span class="inlinecode"><span class="id" title="var">stream_eq</span></span> <span class="inlinecode"><span class="id" title="var">s1</span></span> <span class="inlinecode"><span class="id" title="var">s2</span></span>  
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="cpdt_notes.html#stream_eq_raw:344"><span class="id" title="inductive">stream_eq_raw</span></a> <a class="idref" href="cpdt_notes.html#s1:346"><span class="id" title="variable">s1</span></a> <a class="idref" href="cpdt_notes.html#s2:347"><span class="id" title="variable">s2</span></a>              <br/>
&nbsp;&nbsp;.<br/>

<br/>
</div>

<div class="doc">
Now for the coind principle,
    the hypotheses are exactly the preconds above. 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variables</span> <a id="stream_eq_raw.R" class="idref" href="#stream_eq_raw.R"><span class="id" title="variable">R</span></a> : <a class="idref" href="cpdt_notes.html#stream"><span class="id" title="inductive">stream</span></a> <a class="idref" href="cpdt_notes.html#stream_eq_raw.A"><span class="id" title="variable">A</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#stream"><span class="id" title="inductive">stream</span></a> <a class="idref" href="cpdt_notes.html#stream_eq_raw.A"><span class="id" title="variable">A</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span>.<br/>

<br/>
</div>

<div class="doc">
Precond 1 : equality of heads 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Hypothesis</span> <a id="stream_eq_raw.Cons_case_hd" class="idref" href="#stream_eq_raw.Cons_case_hd"><span class="id" title="variable">Cons_case_hd</span></a> : <span class="id" title="keyword">∀</span> <a id="s1:350" class="idref" href="#s1:350"><span class="id" title="binder">s1</span></a> <a id="s2:351" class="idref" href="#s2:351"><span class="id" title="binder">s2</span></a>, <a class="idref" href="cpdt_notes.html#stream_eq_raw.R"><span class="id" title="variable">R</span></a> <a class="idref" href="cpdt_notes.html#s1:350"><span class="id" title="variable">s1</span></a> <a class="idref" href="cpdt_notes.html#s2:351"><span class="id" title="variable">s2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#hd"><span class="id" title="definition">hd</span></a> <a class="idref" href="cpdt_notes.html#s1:350"><span class="id" title="variable">s1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="cpdt_notes.html#hd"><span class="id" title="definition">hd</span></a> <a class="idref" href="cpdt_notes.html#s2:351"><span class="id" title="variable">s2</span></a>. </div>

<div class="doc">
Precond 2 : equality of tails 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Hypothesis</span> <a id="stream_eq_raw.Cons_case_tl" class="idref" href="#stream_eq_raw.Cons_case_tl"><span class="id" title="variable">Cons_case_tl</span></a> : <span class="id" title="keyword">∀</span> <a id="s1:354" class="idref" href="#s1:354"><span class="id" title="binder">s1</span></a> <a id="s2:355" class="idref" href="#s2:355"><span class="id" title="binder">s2</span></a>, <a class="idref" href="cpdt_notes.html#stream_eq_raw.R"><span class="id" title="variable">R</span></a> <a class="idref" href="cpdt_notes.html#s1:354"><span class="id" title="variable">s1</span></a> <a class="idref" href="cpdt_notes.html#s2:355"><span class="id" title="variable">s2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#stream_eq_raw.R"><span class="id" title="variable">R</span></a> (<a class="idref" href="cpdt_notes.html#tl"><span class="id" title="definition">tl</span></a> <a class="idref" href="cpdt_notes.html#s1:354"><span class="id" title="variable">s1</span></a>) (<a class="idref" href="cpdt_notes.html#tl"><span class="id" title="definition">tl</span></a> <a class="idref" href="cpdt_notes.html#s2:355"><span class="id" title="variable">s2</span></a>). 
<br/>
</div>

<div class="doc">
The result : equality of streams, our <span class="inlinecode"><span class="id" title="var">stream_eq</span></span> <span class="inlinecode"><span class="id" title="var">s1</span></span> <span class="inlinecode"><span class="id" title="var">s2</span></span>  
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <a id="stream_eq_coind_raw" class="idref" href="#stream_eq_coind_raw"><span class="id" title="lemma">stream_eq_coind_raw</span></a> : <span class="id" title="keyword">∀</span> <a id="s1:358" class="idref" href="#s1:358"><span class="id" title="binder">s1</span></a> <a id="s2:359" class="idref" href="#s2:359"><span class="id" title="binder">s2</span></a>, <a class="idref" href="cpdt_notes.html#stream_eq_raw.R"><span class="id" title="variable">R</span></a> <a class="idref" href="cpdt_notes.html#s1:358"><span class="id" title="variable">s1</span></a> <a class="idref" href="cpdt_notes.html#s2:359"><span class="id" title="variable">s2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#stream_eq"><span class="id" title="inductive">stream_eq</span></a> <a class="idref" href="cpdt_notes.html#s1:358"><span class="id" title="variable">s1</span></a> <a class="idref" href="cpdt_notes.html#s2:359"><span class="id" title="variable">s2</span></a>. &nbsp;&nbsp;<span class="id" title="keyword">Abort</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="cpdt_notes.html#stream_eq_raw"><span class="id" title="section">stream_eq_raw</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab46"></a><h2 class="section">Q: Proof v3 : How to prove equality without defining any <span class="inlinecode"><span class="id" title="var">R</span></span> ?</h2>

<div class="paragraph"> </div>

 Better, but we still have to define a clever <span class="inlinecode"><span class="id" title="var">R</span></span>, this is annoying 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Section</span> <a id="stream_eq_loop" class="idref" href="#stream_eq_loop"><span class="id" title="section">stream_eq_loop</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variables</span> <a id="stream_eq_loop.A" class="idref" href="#stream_eq_loop.A"><span class="id" title="variable">A</span></a> : <span class="id" title="keyword">Type</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variables</span> <a id="stream_eq_loop.s1" class="idref" href="#stream_eq_loop.s1"><span class="id" title="variable">s1</span></a> <a id="stream_eq_loop.s2" class="idref" href="#stream_eq_loop.s2"><span class="id" title="variable">s2</span></a> : <a class="idref" href="cpdt_notes.html#stream"><span class="id" title="inductive">stream</span></a> <a class="idref" href="cpdt_notes.html#stream_eq_loop.A"><span class="id" title="variable">A</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hypothesis</span> <a id="stream_eq_loop.Cons_case_hd" class="idref" href="#stream_eq_loop.Cons_case_hd"><span class="id" title="variable">Cons_case_hd</span></a> : <a class="idref" href="cpdt_notes.html#hd"><span class="id" title="definition">hd</span></a> <a class="idref" href="cpdt_notes.html#stream_eq_loop.s1"><span class="id" title="variable">s1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="cpdt_notes.html#hd"><span class="id" title="definition">hd</span></a> <a class="idref" href="cpdt_notes.html#stream_eq_loop.s2"><span class="id" title="variable">s2</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hypothesis</span> <a id="stream_eq_loop.loop1" class="idref" href="#stream_eq_loop.loop1"><span class="id" title="variable">loop1</span></a> : <a class="idref" href="cpdt_notes.html#tl"><span class="id" title="definition">tl</span></a> <a class="idref" href="cpdt_notes.html#stream_eq_loop.s1"><span class="id" title="variable">s1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="cpdt_notes.html#stream_eq_loop.s1"><span class="id" title="variable">s1</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hypothesis</span> <a id="stream_eq_loop.loop2" class="idref" href="#stream_eq_loop.loop2"><span class="id" title="variable">loop2</span></a> : <a class="idref" href="cpdt_notes.html#tl"><span class="id" title="definition">tl</span></a> <a class="idref" href="cpdt_notes.html#stream_eq_loop.s2"><span class="id" title="variable">s2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="cpdt_notes.html#stream_eq_loop.s2"><span class="id" title="variable">s2</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <a id="stream_eq_loop" class="idref" href="#stream_eq_loop"><span class="id" title="lemma">stream_eq_loop</span></a> : <a class="idref" href="cpdt_notes.html#stream_eq"><span class="id" title="inductive">stream_eq</span></a> <a class="idref" href="cpdt_notes.html#stream_eq_loop.s1"><span class="id" title="variable">s1</span></a> <a class="idref" href="cpdt_notes.html#stream_eq_loop.s2"><span class="id" title="variable">s2</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<a class="idref" href="cpdt_notes.html#stream_eq_coind"><span class="id" title="lemma">stream_eq_coind</span></a> (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="s1':372" class="idref" href="#s1':372"><span class="id" title="binder"><span id="s1':374" class="id">s1'</span></span></a> <a id="s2':373" class="idref" href="#s2':373"><span class="id" title="binder"><span id="s2':375" class="id">s2'</span></span></a> ⇒ <a class="idref" href="cpdt_notes.html#s1':372"><span class="id" title="variable">s1'</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="cpdt_notes.html#stream_eq_loop.s1"><span class="id" title="variable">s1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="cpdt_notes.html#s2':373"><span class="id" title="variable">s2'</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="cpdt_notes.html#stream_eq_loop.s2"><span class="id" title="variable">s2</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;)); <span class="id" title="var">crush</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="cpdt_notes.html#stream_eq_loop"><span class="id" title="section">stream_eq_loop</span></a>.<br/>

<br/>
<span class="id" title="keyword">Theorem</span> <a id="stream_a_eq_b_try4" class="idref" href="#stream_a_eq_b_try4"><span class="id" title="lemma">stream_a_eq_b_try4</span></a> : <a class="idref" href="cpdt_notes.html#stream_eq"><span class="id" title="inductive">stream_eq</span></a> <a class="idref" href="cpdt_notes.html#all_ones_a"><span class="id" title="definition">all_ones_a</span></a> <a class="idref" href="cpdt_notes.html#all_ones_b"><span class="id" title="definition">all_ones_b</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="cpdt_notes.html#stream_eq_loop"><span class="id" title="lemma">stream_eq_loop</span></a>; <span class="id" title="var">crush</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab47"></a><h2 class="section">Q: Factorials : Define the stream of factorials</h2>

                    (naive and iterative variants). 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Print</span> <span class="id" title="var">fact</span>.<br/>

<br/>
</div>

<div class="doc">
Let's build the stream of all factorials.
The simplest and naive way is to call <span class="inlinecode"><span class="id" title="var">fact</span></span> on all elements.

</div>
<div class="code">
<span class="id" title="keyword">CoFixpoint</span> <a id="fact_slow_aux" class="idref" href="#fact_slow_aux"><span class="id" title="definition">fact_slow_aux</span></a> (<a id="n:376" class="idref" href="#n:376"><span class="id" title="binder">n</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) : <a class="idref" href="cpdt_notes.html#stream"><span class="id" title="inductive">stream</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> := <a class="idref" href="cpdt_notes.html#Cons"><span class="id" title="constructor">Cons</span></a> (<span class="id" title="definition">fact</span> <a class="idref" href="cpdt_notes.html#n:376"><span class="id" title="variable">n</span></a>) (<a class="idref" href="cpdt_notes.html#fact_slow_aux:377"><span class="id" title="definition">fact_slow_aux</span></a> (<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="cpdt_notes.html#n:376"><span class="id" title="variable">n</span></a>)).<br/>
<span class="id" title="keyword">Definition</span> <a id="fact_slow" class="idref" href="#fact_slow"><span class="id" title="definition">fact_slow</span></a> := <a class="idref" href="cpdt_notes.html#fact_slow_aux"><span class="id" title="definition">fact_slow_aux</span></a> 1.<br/>

<br/>
</div>

<div class="doc">
Now a clever implementation with an accumulator 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">CoFixpoint</span> <a id="fact_iter_aux" class="idref" href="#fact_iter_aux"><span class="id" title="definition">fact_iter_aux</span></a> (<a id="n:378" class="idref" href="#n:378"><span class="id" title="binder">n</span></a> <a id="acc:379" class="idref" href="#acc:379"><span class="id" title="binder">acc</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) :=<br/>
&nbsp;&nbsp;<a class="idref" href="cpdt_notes.html#Cons"><span class="id" title="constructor">Cons</span></a> (<a class="idref" href="cpdt_notes.html#acc:379"><span class="id" title="variable">acc</span></a>) (<a class="idref" href="cpdt_notes.html#fact_iter_aux:380"><span class="id" title="definition">fact_iter_aux</span></a> (<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="cpdt_notes.html#n:378"><span class="id" title="variable">n</span></a>) (<a class="idref" href="cpdt_notes.html#n:378"><span class="id" title="variable">n</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#ea2ff3d561159081cea6fb2e8113cc54"><span class="id" title="notation">×</span></a> <a class="idref" href="cpdt_notes.html#acc:379"><span class="id" title="variable">acc</span></a>)).<br/>
<span class="id" title="keyword">Definition</span> <a id="fact_iter" class="idref" href="#fact_iter"><span class="id" title="definition">fact_iter</span></a> := <a class="idref" href="cpdt_notes.html#fact_iter_aux"><span class="id" title="definition">fact_iter_aux</span></a> 2 1.<br/>

<br/>
<span class="id" title="keyword">Eval</span> <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <a class="idref" href="cpdt_notes.html#approx"><span class="id" title="definition">approx</span></a> <a class="idref" href="cpdt_notes.html#fact_slow"><span class="id" title="definition">fact_slow</span></a> 5.<br/>
<span class="id" title="keyword">Eval</span> <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <a class="idref" href="cpdt_notes.html#approx"><span class="id" title="definition">approx</span></a> <a class="idref" href="cpdt_notes.html#fact_iter"><span class="id" title="definition">fact_iter</span></a> 5.<br/>

<br/>
</div>

<div class="doc">
<a id="lab48"></a><h2 class="section">Q: Factorials v1 : Prove them equal</h2>

<div class="paragraph"> </div>

 Some magic in the book not explained on purpose yet. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="fact_def" class="idref" href="#fact_def"><span class="id" title="lemma">fact_def</span></a> : <span class="id" title="keyword">∀</span> <a id="x:381" class="idref" href="#x:381"><span class="id" title="binder">x</span></a> <a id="n:382" class="idref" href="#n:382"><span class="id" title="binder">n</span></a>,<br/>
<a class="idref" href="cpdt_notes.html#fact_iter_aux"><span class="id" title="definition">fact_iter_aux</span></a> <a class="idref" href="cpdt_notes.html#x:381"><span class="id" title="variable">x</span></a> (<span class="id" title="definition">fact</span> <a class="idref" href="cpdt_notes.html#n:382"><span class="id" title="variable">n</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#ea2ff3d561159081cea6fb2e8113cc54"><span class="id" title="notation">×</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="cpdt_notes.html#n:382"><span class="id" title="variable">n</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="cpdt_notes.html#fact_iter_aux"><span class="id" title="definition">fact_iter_aux</span></a> <a class="idref" href="cpdt_notes.html#x:381"><span class="id" title="variable">x</span></a> (<span class="id" title="definition">fact</span> (<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="cpdt_notes.html#n:382"><span class="id" title="variable">n</span></a>)).<br/>
<span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">f_equal</span>; <span class="id" title="tactic">ring</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">fact_def</span>.<br/>

<br/>
<span class="id" title="keyword">Check</span> <a class="idref" href="cpdt_notes.html#stream_eq_coind"><span class="id" title="lemma">stream_eq_coind</span></a>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="fact_eq'" class="idref" href="#fact_eq'"><span class="id" title="lemma">fact_eq'</span></a> : <span class="id" title="keyword">∀</span> <a id="n:383" class="idref" href="#n:383"><span class="id" title="binder">n</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="cpdt_notes.html#stream_eq"><span class="id" title="inductive">stream_eq</span></a> (<a class="idref" href="cpdt_notes.html#fact_iter_aux"><span class="id" title="definition">fact_iter_aux</span></a> (<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="cpdt_notes.html#n:383"><span class="id" title="variable">n</span></a>) (<span class="id" title="definition">fact</span> <a class="idref" href="cpdt_notes.html#n:383"><span class="id" title="variable">n</span></a>)) (<a class="idref" href="cpdt_notes.html#fact_slow_aux"><span class="id" title="definition">fact_slow_aux</span></a> <a class="idref" href="cpdt_notes.html#n:383"><span class="id" title="variable">n</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">R</span> := (<span class="id" title="keyword">fun</span> <a id="s1:384" class="idref" href="#s1:384"><span class="id" title="binder"><span id="s1:387" class="id">s1</span></span></a> <a id="s2:385" class="idref" href="#s2:385"><span class="id" title="binder"><span id="s2:388" class="id">s2</span></span></a> ⇒ <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">∃</span></a> <a id="n:386" class="idref" href="#n:386"><span class="id" title="binder"><span id="n:389" class="id">n</span></span></a><a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="cpdt_notes.html#s1:384"><span class="id" title="variable">s1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="cpdt_notes.html#fact_iter_aux"><span class="id" title="definition">fact_iter_aux</span></a> (<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="cpdt_notes.html#n:386"><span class="id" title="variable">n</span></a>) (<span class="id" title="definition">fact</span> <a class="idref" href="cpdt_notes.html#n:386"><span class="id" title="variable">n</span></a>)<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="cpdt_notes.html#s2:385"><span class="id" title="variable">s2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="cpdt_notes.html#fact_slow_aux"><span class="id" title="definition">fact_slow_aux</span></a> <a class="idref" href="cpdt_notes.html#n:386"><span class="id" title="variable">n</span></a><a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intro</span>; <span class="id" title="tactic">apply</span> (<a class="idref" href="cpdt_notes.html#stream_eq_coind"><span class="id" title="lemma">stream_eq_coind</span></a> <span class="id" title="var">R</span>); <span class="id" title="tactic">unfold</span> <span class="id" title="var">R</span> <span class="id" title="tactic">in</span> *; <span class="id" title="var">crush</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Theorem</span> <a id="fact_eq" class="idref" href="#fact_eq"><span class="id" title="lemma">fact_eq</span></a> : <a class="idref" href="cpdt_notes.html#stream_eq"><span class="id" title="inductive">stream_eq</span></a> <a class="idref" href="cpdt_notes.html#fact_iter"><span class="id" title="definition">fact_iter</span></a> <a class="idref" href="cpdt_notes.html#fact_slow"><span class="id" title="definition">fact_slow</span></a>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="cpdt_notes.html#fact_eq'"><span class="id" title="lemma">fact_eq'</span></a>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab49"></a><h2 class="section">Q: Factorials v2 : Simpler proof of lemma</h2>

                    through <span class="inlinecode"><span class="id" title="var">stream_eq_loop</span></span> trick. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Section</span> <a id="stream_eq_loop_onequant" class="idref" href="#stream_eq_loop_onequant"><span class="id" title="section">stream_eq_loop_onequant</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variables</span> <a id="stream_eq_loop_onequant.A" class="idref" href="#stream_eq_loop_onequant.A"><span class="id" title="variable">A</span></a> <a id="stream_eq_loop_onequant.B" class="idref" href="#stream_eq_loop_onequant.B"><span class="id" title="variable">B</span></a> : <span class="id" title="keyword">Type</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variables</span> <a id="stream_eq_loop_onequant.f1" class="idref" href="#stream_eq_loop_onequant.f1"><span class="id" title="variable">f1</span></a> <a id="stream_eq_loop_onequant.f2" class="idref" href="#stream_eq_loop_onequant.f2"><span class="id" title="variable">f2</span></a> : <a class="idref" href="cpdt_notes.html#stream_eq_loop_onequant.A"><span class="id" title="variable">A</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#stream"><span class="id" title="inductive">stream</span></a> <a class="idref" href="cpdt_notes.html#stream_eq_loop_onequant.B"><span class="id" title="variable">B</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hypothesis</span> <a id="stream_eq_loop_onequant.Coind_hd" class="idref" href="#stream_eq_loop_onequant.Coind_hd"><span class="id" title="variable">Coind_hd</span></a> : <span class="id" title="keyword">∀</span> <a id="x:398" class="idref" href="#x:398"><span class="id" title="binder">x</span></a>, <a class="idref" href="cpdt_notes.html#hd"><span class="id" title="definition">hd</span></a> (<a class="idref" href="cpdt_notes.html#stream_eq_loop_onequant.f1"><span class="id" title="variable">f1</span></a> <a class="idref" href="cpdt_notes.html#x:398"><span class="id" title="variable">x</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="cpdt_notes.html#hd"><span class="id" title="definition">hd</span></a> (<a class="idref" href="cpdt_notes.html#stream_eq_loop_onequant.f2"><span class="id" title="variable">f2</span></a> <a class="idref" href="cpdt_notes.html#x:398"><span class="id" title="variable">x</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hypothesis</span> <a id="stream_eq_loop_onequant.Coind_tl" class="idref" href="#stream_eq_loop_onequant.Coind_tl"><span class="id" title="variable">Coind_tl</span></a> : <span class="id" title="keyword">∀</span> <a id="x:401" class="idref" href="#x:401"><span class="id" title="binder">x</span></a>, <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">∃</span></a> <a id="y:402" class="idref" href="#y:402"><span class="id" title="binder">y</span></a><a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="cpdt_notes.html#tl"><span class="id" title="definition">tl</span></a> (<a class="idref" href="cpdt_notes.html#stream_eq_loop_onequant.f1"><span class="id" title="variable">f1</span></a> <a class="idref" href="cpdt_notes.html#x:401"><span class="id" title="variable">x</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="cpdt_notes.html#stream_eq_loop_onequant.f1"><span class="id" title="variable">f1</span></a> <a class="idref" href="cpdt_notes.html#y:402"><span class="id" title="variable">y</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="cpdt_notes.html#tl"><span class="id" title="definition">tl</span></a> (<a class="idref" href="cpdt_notes.html#stream_eq_loop_onequant.f2"><span class="id" title="variable">f2</span></a> <a class="idref" href="cpdt_notes.html#x:401"><span class="id" title="variable">x</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="cpdt_notes.html#stream_eq_loop_onequant.f2"><span class="id" title="variable">f2</span></a> <a class="idref" href="cpdt_notes.html#y:402"><span class="id" title="variable">y</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <a id="stream_eq_loop_onequant" class="idref" href="#stream_eq_loop_onequant"><span class="id" title="lemma">stream_eq_loop_onequant</span></a> : <span class="id" title="keyword">∀</span> <a id="x:405" class="idref" href="#x:405"><span class="id" title="binder">x</span></a>, <a class="idref" href="cpdt_notes.html#stream_eq"><span class="id" title="inductive">stream_eq</span></a> (<a class="idref" href="cpdt_notes.html#stream_eq_loop_onequant.f1"><span class="id" title="variable">f1</span></a> <a class="idref" href="cpdt_notes.html#x:405"><span class="id" title="variable">x</span></a>) (<a class="idref" href="cpdt_notes.html#stream_eq_loop_onequant.f2"><span class="id" title="variable">f2</span></a> <a class="idref" href="cpdt_notes.html#x:405"><span class="id" title="variable">x</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<a class="idref" href="cpdt_notes.html#stream_eq_coind"><span class="id" title="lemma">stream_eq_coind</span></a> (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="s1:406" class="idref" href="#s1:406"><span class="id" title="binder"><span id="s1:409" class="id">s1</span></span></a> <a id="s2:407" class="idref" href="#s2:407"><span class="id" title="binder"><span id="s2:410" class="id">s2</span></span></a> ⇒ <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">∃</span></a> <a id="y:408" class="idref" href="#y:408"><span class="id" title="binder"><span id="y:411" class="id">y</span></span></a><a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="cpdt_notes.html#s1:406"><span class="id" title="variable">s1</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="cpdt_notes.html#stream_eq_loop_onequant.f1"><span class="id" title="variable">f1</span></a> <a class="idref" href="cpdt_notes.html#y:408"><span class="id" title="variable">y</span></a><a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="cpdt_notes.html#s2:407"><span class="id" title="variable">s2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="cpdt_notes.html#stream_eq_loop_onequant.f2"><span class="id" title="variable">f2</span></a> <a class="idref" href="cpdt_notes.html#y:408"><span class="id" title="variable">y</span></a><a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;)); <span class="id" title="var">crush</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="cpdt_notes.html#stream_eq_loop_onequant"><span class="id" title="section">stream_eq_loop_onequant</span></a>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="fact_eq''" class="idref" href="#fact_eq''"><span class="id" title="lemma">fact_eq''</span></a> : <span class="id" title="keyword">∀</span> <a id="n:412" class="idref" href="#n:412"><span class="id" title="binder">n</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="cpdt_notes.html#stream_eq"><span class="id" title="inductive">stream_eq</span></a> (<a class="idref" href="cpdt_notes.html#fact_iter_aux"><span class="id" title="definition">fact_iter_aux</span></a> (<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="cpdt_notes.html#n:412"><span class="id" title="variable">n</span></a>) (<span class="id" title="definition">fact</span> <a class="idref" href="cpdt_notes.html#n:412"><span class="id" title="variable">n</span></a>)) (<a class="idref" href="cpdt_notes.html#fact_slow_aux"><span class="id" title="definition">fact_slow_aux</span></a> <a class="idref" href="cpdt_notes.html#n:412"><span class="id" title="variable">n</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="cpdt_notes.html#stream_eq_loop_onequant"><span class="id" title="lemma">stream_eq_loop_onequant</span></a>; <span class="id" title="var">crush</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab50"></a><h1 class="section">5.3 - Simple Modeling of non-terminating programs</h1>

</div>
<div class="code">

<br/>
</div>

<div class="doc">
<a id="lab51"></a><h2 class="section">Q: Define a little language with :</h2>


<div class="paragraph"> </div>

  The memory : 
<ul class="doclist">
<li> <span class="inlinecode"><span class="id" title="var">var</span></span> as <span class="inlinecode"><span class="id" title="var">nat</span></span>

</li>
<li> <span class="inlinecode"><span class="id" title="var">vars</span></span> as a map from variables to values

</li>
<li> <span class="inlinecode"><span class="id" title="tactic">set</span></span> to assign a value to a variable

</li>
</ul>

<div class="paragraph"> </div>

  The expressions :
<ul class="doclist">
<li> constant

</li>
<li> variable

</li>
<li> addition

</li>
</ul>

<div class="paragraph"> </div>

  (and an evaluation function)

<div class="paragraph"> </div>

  The commands :
<ul class="doclist">
<li> assignment

</li>
<li> sequence

</li>
<li> while loop (let's say <span class="inlinecode"><span class="id" title="var">cond</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">expr</span></span>, and <span class="inlinecode"><span class="id" title="var">false</span></span> means <span class="inlinecode"><span class="id" title="var">eq</span></span> <span class="inlinecode">0</span>)

</li>
</ul>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a id="var" class="idref" href="#var"><span class="id" title="definition">var</span></a> := <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>.<br/>
<span class="id" title="keyword">Definition</span> <a id="vars" class="idref" href="#vars"><span class="id" title="definition">vars</span></a> := <a class="idref" href="cpdt_notes.html#var"><span class="id" title="definition">var</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="set" class="idref" href="#set"><span class="id" title="definition">set</span></a> (<a id="vs:413" class="idref" href="#vs:413"><span class="id" title="binder">vs</span></a> : <a class="idref" href="cpdt_notes.html#vars"><span class="id" title="definition">vars</span></a>) (<a id="v:414" class="idref" href="#v:414"><span class="id" title="binder">v</span></a> : <a class="idref" href="cpdt_notes.html#var"><span class="id" title="definition">var</span></a>) (<a id="n:415" class="idref" href="#n:415"><span class="id" title="binder">n</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) : <a class="idref" href="cpdt_notes.html#vars"><span class="id" title="definition">vars</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="v':416" class="idref" href="#v':416"><span class="id" title="binder">v'</span></a> ⇒ <span class="id" title="keyword">if</span> <span class="id" title="definition">Nat.eqb</span> <a class="idref" href="cpdt_notes.html#v':416"><span class="id" title="variable">v'</span></a> <a class="idref" href="cpdt_notes.html#v:414"><span class="id" title="variable">v</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="cpdt_notes.html#n:415"><span class="id" title="variable">n</span></a> <span class="id" title="keyword">else</span> <a class="idref" href="cpdt_notes.html#vs:413"><span class="id" title="variable">vs</span></a> <a class="idref" href="cpdt_notes.html#v:414"><span class="id" title="variable">v</span></a>.<br/>

<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <a id="exp" class="idref" href="#exp"><span class="id" title="definition, inductive"><span id="exp_rect" class="id"><span id="exp_ind" class="id"><span id="exp_rec" class="id"><span id="exp_sind" class="id">exp</span></span></span></span></span></a> : <span class="id" title="keyword">Set</span> :=<br/>
| <a id="E_Const" class="idref" href="#E_Const"><span class="id" title="constructor">E_Const</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#exp:417"><span class="id" title="inductive">exp</span></a><br/>
| <a id="E_Var" class="idref" href="#E_Var"><span class="id" title="constructor">E_Var</span></a> : <a class="idref" href="cpdt_notes.html#var"><span class="id" title="definition">var</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#exp:417"><span class="id" title="inductive">exp</span></a><br/>
| <a id="E_Plus" class="idref" href="#E_Plus"><span class="id" title="constructor">E_Plus</span></a> : <a class="idref" href="cpdt_notes.html#exp:417"><span class="id" title="inductive">exp</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#exp:417"><span class="id" title="inductive">exp</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#exp:417"><span class="id" title="inductive">exp</span></a><br/>
.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <a id="evalExp" class="idref" href="#evalExp"><span class="id" title="definition">evalExp</span></a> (<a id="vs:419" class="idref" href="#vs:419"><span class="id" title="binder">vs</span></a> : <a class="idref" href="cpdt_notes.html#vars"><span class="id" title="definition">vars</span></a>) (<a id="e:420" class="idref" href="#e:420"><span class="id" title="binder">e</span></a> : <a class="idref" href="cpdt_notes.html#exp"><span class="id" title="inductive">exp</span></a>) : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="cpdt_notes.html#e:420"><span class="id" title="variable">e</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="cpdt_notes.html#E_Const"><span class="id" title="constructor">E_Const</span></a> <span class="id" title="var">n</span> ⇒ <span class="id" title="var">n</span><br/>
&nbsp;&nbsp;| <a class="idref" href="cpdt_notes.html#E_Var"><span class="id" title="constructor">E_Var</span></a> <span class="id" title="var">v</span> ⇒ <a class="idref" href="cpdt_notes.html#vs:419"><span class="id" title="variable">vs</span></a> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;| <a class="idref" href="cpdt_notes.html#E_Plus"><span class="id" title="constructor">E_Plus</span></a> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> ⇒ <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">(</span></a><a class="idref" href="cpdt_notes.html#evalExp:421"><span class="id" title="definition">evalExp</span></a> <a class="idref" href="cpdt_notes.html#vs:419"><span class="id" title="variable">vs</span></a> <span class="id" title="var">e1</span><a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">)</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">(</span></a><a class="idref" href="cpdt_notes.html#evalExp:421"><span class="id" title="definition">evalExp</span></a> <a class="idref" href="cpdt_notes.html#vs:419"><span class="id" title="variable">vs</span></a> <span class="id" title="var">e2</span><a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <a id="cmd" class="idref" href="#cmd"><span class="id" title="definition, inductive"><span id="cmd_rect" class="id"><span id="cmd_ind" class="id"><span id="cmd_rec" class="id"><span id="cmd_sind" class="id">cmd</span></span></span></span></span></a> : <span class="id" title="keyword">Set</span> :=<br/>
| <a id="C_Asgn" class="idref" href="#C_Asgn"><span class="id" title="constructor">C_Asgn</span></a> : <a class="idref" href="cpdt_notes.html#var"><span class="id" title="definition">var</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#exp"><span class="id" title="inductive">exp</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#cmd:423"><span class="id" title="inductive">cmd</span></a>    <br/>
| <a id="C_Seq" class="idref" href="#C_Seq"><span class="id" title="constructor">C_Seq</span></a> : <a class="idref" href="cpdt_notes.html#cmd:423"><span class="id" title="inductive">cmd</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#cmd:423"><span class="id" title="inductive">cmd</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#cmd:423"><span class="id" title="inductive">cmd</span></a>     <br/>
| <a id="C_While" class="idref" href="#C_While"><span class="id" title="constructor">C_While</span></a> : <a class="idref" href="cpdt_notes.html#exp"><span class="id" title="inductive">exp</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#cmd:423"><span class="id" title="inductive">cmd</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#cmd:423"><span class="id" title="inductive">cmd</span></a>  <br/>
.<br/>

<br/>
</div>

<div class="doc">
<a id="lab52"></a><h2 class="section">Q: Now, what object to define the evaluation of command, and why ?</h2>

<div class="paragraph"> </div>

 Defining it as a function won't work because
    it could not terminate because of infinite <span class="inlinecode"><span class="id" title="var">C_While</span></span> loops,
    and Rocq won't allow us to build such a non-terminating function.

<div class="paragraph"> </div>

    Below we try and it indeed fails,
    saying it can't determine a decreasing argument,
    which is normal because there can't be one.

</div>
<div class="code">

<br/>
<span class="id" title="var">Fail</span> <span class="id" title="keyword">Fixpoint</span> <a id="evalCmd_fix" class="idref" href="#evalCmd_fix"><span class="id" title="definition">evalCmd_fix</span></a> (<a id="vs:425" class="idref" href="#vs:425"><span class="id" title="binder">vs</span></a> : <a class="idref" href="cpdt_notes.html#vars"><span class="id" title="definition">vars</span></a>) (<a id="c:426" class="idref" href="#c:426"><span class="id" title="binder">c</span></a> : <a class="idref" href="cpdt_notes.html#cmd"><span class="id" title="inductive">cmd</span></a>) : <a class="idref" href="cpdt_notes.html#vars"><span class="id" title="definition">vars</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="self:428" class="idref" href="#self:428"><span class="id" title="binder">self</span></a> := <a class="idref" href="cpdt_notes.html#evalCmd_fix:427"><span class="id" title="definition">evalCmd_fix</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="cpdt_notes.html#c:426"><span class="id" title="variable">c</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="cpdt_notes.html#C_Asgn"><span class="id" title="constructor">C_Asgn</span></a> <span class="id" title="var">v</span> <span class="id" title="var">e</span> ⇒ <a class="idref" href="cpdt_notes.html#set"><span class="id" title="definition">set</span></a> <a class="idref" href="cpdt_notes.html#vs:425"><span class="id" title="variable">vs</span></a> <span class="id" title="var">v</span> (<a class="idref" href="cpdt_notes.html#evalExp"><span class="id" title="definition">evalExp</span></a> <a class="idref" href="cpdt_notes.html#vs:425"><span class="id" title="variable">vs</span></a> <span class="id" title="var">e</span>)<br/>
&nbsp;&nbsp;| <a class="idref" href="cpdt_notes.html#C_Seq"><span class="id" title="constructor">C_Seq</span></a> <span class="id" title="var">c1</span> <span class="id" title="var">c2</span> ⇒ (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="vs':430" class="idref" href="#vs':430"><span class="id" title="binder">vs'</span></a> := <a class="idref" href="cpdt_notes.html#self:428"><span class="id" title="variable">self</span></a> <a class="idref" href="cpdt_notes.html#vs:425"><span class="id" title="variable">vs</span></a> <span class="id" title="var">c1</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="cpdt_notes.html#self:428"><span class="id" title="variable">self</span></a> <a class="idref" href="cpdt_notes.html#vs':430"><span class="id" title="variable">vs'</span></a> <span class="id" title="var">c2</span>)<br/>
&nbsp;&nbsp;| <a class="idref" href="cpdt_notes.html#C_While"><span class="id" title="constructor">C_While</span></a> <span class="id" title="var">cond</span> <span class="id" title="var">body</span> ⇒ (<span class="id" title="keyword">if</span> <span class="id" title="definition">Nat.eqb</span> (<a class="idref" href="cpdt_notes.html#evalExp"><span class="id" title="definition">evalExp</span></a> <a class="idref" href="cpdt_notes.html#vs:425"><span class="id" title="variable">vs</span></a> <span class="id" title="var">cond</span>) 0 <span class="id" title="keyword">then</span> <a class="idref" href="cpdt_notes.html#vs:425"><span class="id" title="variable">vs</span></a> <span class="id" title="keyword">else</span> (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="vs':431" class="idref" href="#vs':431"><span class="id" title="binder">vs'</span></a> := <a class="idref" href="cpdt_notes.html#self:428"><span class="id" title="variable">self</span></a> <a class="idref" href="cpdt_notes.html#vs:425"><span class="id" title="variable">vs</span></a> <span class="id" title="var">body</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="cpdt_notes.html#self:428"><span class="id" title="variable">self</span></a> <a class="idref" href="cpdt_notes.html#vs':431"><span class="id" title="variable">vs'</span></a> <a class="idref" href="cpdt_notes.html#c:426"><span class="id" title="variable">c</span></a>))<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Inductive definition won't capture non-terminating executions.
    So we go with the CoInductive definition.  
</div>
<div class="code">
<span class="id" title="keyword">CoInductive</span> <a id="evalCmd" class="idref" href="#evalCmd"><span class="id" title="inductive">evalCmd</span></a> : <a class="idref" href="cpdt_notes.html#vars"><span class="id" title="definition">vars</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#cmd"><span class="id" title="inductive">cmd</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#vars"><span class="id" title="definition">vars</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
| <a id="EC_Assign" class="idref" href="#EC_Assign"><span class="id" title="constructor">EC_Assign</span></a> : <span class="id" title="keyword">∀</span> (<a id="vs:434" class="idref" href="#vs:434"><span class="id" title="binder">vs</span></a> : <a class="idref" href="cpdt_notes.html#vars"><span class="id" title="definition">vars</span></a>) (<a id="v:435" class="idref" href="#v:435"><span class="id" title="binder">v</span></a> : <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="e:436" class="idref" href="#e:436"><span class="id" title="binder">e</span></a> : <a class="idref" href="cpdt_notes.html#exp"><span class="id" title="inductive">exp</span></a>), <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="cpdt_notes.html#evalCmd:432"><span class="id" title="inductive">evalCmd</span></a> <a class="idref" href="cpdt_notes.html#vs:434"><span class="id" title="variable">vs</span></a>  (<a class="idref" href="cpdt_notes.html#C_Asgn"><span class="id" title="constructor">C_Asgn</span></a> <a class="idref" href="cpdt_notes.html#v:435"><span class="id" title="variable">v</span></a> <a class="idref" href="cpdt_notes.html#e:436"><span class="id" title="variable">e</span></a>)  (<a class="idref" href="cpdt_notes.html#set"><span class="id" title="definition">set</span></a> <a class="idref" href="cpdt_notes.html#vs:434"><span class="id" title="variable">vs</span></a> <a class="idref" href="cpdt_notes.html#v:435"><span class="id" title="variable">v</span></a> (<a class="idref" href="cpdt_notes.html#evalExp"><span class="id" title="definition">evalExp</span></a> <a class="idref" href="cpdt_notes.html#vs:434"><span class="id" title="variable">vs</span></a> <a class="idref" href="cpdt_notes.html#e:436"><span class="id" title="variable">e</span></a>))<br/>
| <a id="EC_Seq" class="idref" href="#EC_Seq"><span class="id" title="constructor">EC_Seq</span></a> : <span class="id" title="keyword">∀</span> <a id="c1:437" class="idref" href="#c1:437"><span class="id" title="binder">c1</span></a> <a id="c2:438" class="idref" href="#c2:438"><span class="id" title="binder">c2</span></a> <a id="vs:439" class="idref" href="#vs:439"><span class="id" title="binder">vs</span></a> <a id="vs':440" class="idref" href="#vs':440"><span class="id" title="binder">vs'</span></a> <a id="vs'':441" class="idref" href="#vs'':441"><span class="id" title="binder">vs''</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="cpdt_notes.html#evalCmd:432"><span class="id" title="inductive">evalCmd</span></a> <a class="idref" href="cpdt_notes.html#vs:439"><span class="id" title="variable">vs</span></a>  <a class="idref" href="cpdt_notes.html#c1:437"><span class="id" title="variable">c1</span></a> <a class="idref" href="cpdt_notes.html#vs':440"><span class="id" title="variable">vs'</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="cpdt_notes.html#evalCmd:432"><span class="id" title="inductive">evalCmd</span></a> <a class="idref" href="cpdt_notes.html#vs':440"><span class="id" title="variable">vs'</span></a> <a class="idref" href="cpdt_notes.html#c2:438"><span class="id" title="variable">c2</span></a> <a class="idref" href="cpdt_notes.html#vs'':441"><span class="id" title="variable">vs''</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="cpdt_notes.html#evalCmd:432"><span class="id" title="inductive">evalCmd</span></a> <a class="idref" href="cpdt_notes.html#vs:439"><span class="id" title="variable">vs</span></a>  (<a class="idref" href="cpdt_notes.html#C_Seq"><span class="id" title="constructor">C_Seq</span></a> <a class="idref" href="cpdt_notes.html#c1:437"><span class="id" title="variable">c1</span></a> <a class="idref" href="cpdt_notes.html#c2:438"><span class="id" title="variable">c2</span></a>)  <a class="idref" href="cpdt_notes.html#vs'':441"><span class="id" title="variable">vs''</span></a><br/>
| <a id="EC_WhileFalse" class="idref" href="#EC_WhileFalse"><span class="id" title="constructor">EC_WhileFalse</span></a> : <span class="id" title="keyword">∀</span> <a id="cond:442" class="idref" href="#cond:442"><span class="id" title="binder">cond</span></a> <a id="body:443" class="idref" href="#body:443"><span class="id" title="binder">body</span></a> <a id="vs:444" class="idref" href="#vs:444"><span class="id" title="binder">vs</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="cpdt_notes.html#evalExp"><span class="id" title="definition">evalExp</span></a> <a class="idref" href="cpdt_notes.html#vs:444"><span class="id" title="variable">vs</span></a> <a class="idref" href="cpdt_notes.html#cond:442"><span class="id" title="variable">cond</span></a><a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> 0 <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="cpdt_notes.html#evalCmd:432"><span class="id" title="inductive">evalCmd</span></a> <a class="idref" href="cpdt_notes.html#vs:444"><span class="id" title="variable">vs</span></a>  (<a class="idref" href="cpdt_notes.html#C_While"><span class="id" title="constructor">C_While</span></a> <a class="idref" href="cpdt_notes.html#cond:442"><span class="id" title="variable">cond</span></a> <a class="idref" href="cpdt_notes.html#body:443"><span class="id" title="variable">body</span></a>)  <a class="idref" href="cpdt_notes.html#vs:444"><span class="id" title="variable">vs</span></a><br/>
| <a id="EC_WhileTrue" class="idref" href="#EC_WhileTrue"><span class="id" title="constructor">EC_WhileTrue</span></a> : <span class="id" title="keyword">∀</span> <a id="cond:445" class="idref" href="#cond:445"><span class="id" title="binder">cond</span></a> <a id="body:446" class="idref" href="#body:446"><span class="id" title="binder">body</span></a> <a id="vs:447" class="idref" href="#vs:447"><span class="id" title="binder">vs</span></a> <a id="vs':448" class="idref" href="#vs':448"><span class="id" title="binder">vs'</span></a> <a id="vs'':449" class="idref" href="#vs'':449"><span class="id" title="binder">vs''</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="cpdt_notes.html#evalExp"><span class="id" title="definition">evalExp</span></a> <a class="idref" href="cpdt_notes.html#vs:447"><span class="id" title="variable">vs</span></a> <a class="idref" href="cpdt_notes.html#cond:445"><span class="id" title="variable">cond</span></a><a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#evalCmd:432"><span class="id" title="inductive">evalCmd</span></a> <a class="idref" href="cpdt_notes.html#vs:447"><span class="id" title="variable">vs</span></a>   <a class="idref" href="cpdt_notes.html#body:446"><span class="id" title="variable">body</span></a>  <a class="idref" href="cpdt_notes.html#vs':448"><span class="id" title="variable">vs'</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#evalCmd:432"><span class="id" title="inductive">evalCmd</span></a> <a class="idref" href="cpdt_notes.html#vs':448"><span class="id" title="variable">vs'</span></a>  (<a class="idref" href="cpdt_notes.html#C_While"><span class="id" title="constructor">C_While</span></a> <a class="idref" href="cpdt_notes.html#cond:445"><span class="id" title="variable">cond</span></a> <a class="idref" href="cpdt_notes.html#body:446"><span class="id" title="variable">body</span></a>)  <a class="idref" href="cpdt_notes.html#vs'':449"><span class="id" title="variable">vs''</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#evalCmd:432"><span class="id" title="inductive">evalCmd</span></a> <a class="idref" href="cpdt_notes.html#vs:447"><span class="id" title="variable">vs</span></a>   (<a class="idref" href="cpdt_notes.html#C_While"><span class="id" title="constructor">C_While</span></a> <a class="idref" href="cpdt_notes.html#cond:445"><span class="id" title="variable">cond</span></a> <a class="idref" href="cpdt_notes.html#body:446"><span class="id" title="variable">body</span></a>)  <a class="idref" href="cpdt_notes.html#vs'':449"><span class="id" title="variable">vs''</span></a><br/>
.<br/>

<br/>
</div>

<div class="doc">
<a id="lab53"></a><h2 class="section">Q: Define a coinductive principle for the <span class="inlinecode"><span class="id" title="var">evalCmd</span></span> relation.</h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Section</span> <a id="evalCmd_coind" class="idref" href="#evalCmd_coind"><span class="id" title="section">evalCmd_coind</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variables</span> <a id="evalCmd_coind.R" class="idref" href="#evalCmd_coind.R"><span class="id" title="variable">R</span></a> : <a class="idref" href="cpdt_notes.html#vars"><span class="id" title="definition">vars</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#cmd"><span class="id" title="inductive">cmd</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#vars"><span class="id" title="definition">vars</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hypothesis</span> <a id="evalCmd_coind.HC_Asgn" class="idref" href="#evalCmd_coind.HC_Asgn"><span class="id" title="variable">HC_Asgn</span></a> : <span class="id" title="keyword">∀</span> <a id="vs:452" class="idref" href="#vs:452"><span class="id" title="binder">vs</span></a> <a id="vs':453" class="idref" href="#vs':453"><span class="id" title="binder">vs'</span></a> <a id="v:454" class="idref" href="#v:454"><span class="id" title="binder">v</span></a> <a id="e:455" class="idref" href="#e:455"><span class="id" title="binder">e</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="cpdt_notes.html#evalCmd_coind.R"><span class="id" title="variable">R</span></a> <a class="idref" href="cpdt_notes.html#vs:452"><span class="id" title="variable">vs</span></a> (<a class="idref" href="cpdt_notes.html#C_Asgn"><span class="id" title="constructor">C_Asgn</span></a> <a class="idref" href="cpdt_notes.html#v:454"><span class="id" title="variable">v</span></a> <a class="idref" href="cpdt_notes.html#e:455"><span class="id" title="variable">e</span></a>) <a class="idref" href="cpdt_notes.html#vs':453"><span class="id" title="variable">vs'</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#vs':453"><span class="id" title="variable">vs'</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="cpdt_notes.html#set"><span class="id" title="definition">set</span></a> <a class="idref" href="cpdt_notes.html#vs:452"><span class="id" title="variable">vs</span></a> <a class="idref" href="cpdt_notes.html#v:454"><span class="id" title="variable">v</span></a> (<a class="idref" href="cpdt_notes.html#evalExp"><span class="id" title="definition">evalExp</span></a> <a class="idref" href="cpdt_notes.html#vs:452"><span class="id" title="variable">vs</span></a> <a class="idref" href="cpdt_notes.html#e:455"><span class="id" title="variable">e</span></a>)<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hypothesis</span> <a id="evalCmd_coind.HC_Seq" class="idref" href="#evalCmd_coind.HC_Seq"><span class="id" title="variable">HC_Seq</span></a> : <span class="id" title="keyword">∀</span> <a id="c1:458" class="idref" href="#c1:458"><span class="id" title="binder">c1</span></a> <a id="c2:459" class="idref" href="#c2:459"><span class="id" title="binder">c2</span></a> <a id="vs:460" class="idref" href="#vs:460"><span class="id" title="binder">vs</span></a> <a id="vs':461" class="idref" href="#vs':461"><span class="id" title="binder">vs'</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="cpdt_notes.html#evalCmd_coind.R"><span class="id" title="variable">R</span></a> <a class="idref" href="cpdt_notes.html#vs:460"><span class="id" title="variable">vs</span></a> (<a class="idref" href="cpdt_notes.html#C_Seq"><span class="id" title="constructor">C_Seq</span></a> <a class="idref" href="cpdt_notes.html#c1:458"><span class="id" title="variable">c1</span></a> <a class="idref" href="cpdt_notes.html#c2:459"><span class="id" title="variable">c2</span></a>) <a class="idref" href="cpdt_notes.html#vs':461"><span class="id" title="variable">vs'</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">∃</span></a> <a id="vs'':462" class="idref" href="#vs'':462"><span class="id" title="binder">vs''</span></a><a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="cpdt_notes.html#evalCmd_coind.R"><span class="id" title="variable">R</span></a> <a class="idref" href="cpdt_notes.html#vs:460"><span class="id" title="variable">vs</span></a> <a class="idref" href="cpdt_notes.html#c1:458"><span class="id" title="variable">c1</span></a> <a class="idref" href="cpdt_notes.html#vs'':462"><span class="id" title="variable">vs''</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="cpdt_notes.html#evalCmd_coind.R"><span class="id" title="variable">R</span></a> <a class="idref" href="cpdt_notes.html#vs'':462"><span class="id" title="variable">vs''</span></a> <a class="idref" href="cpdt_notes.html#c2:459"><span class="id" title="variable">c2</span></a> <a class="idref" href="cpdt_notes.html#vs':461"><span class="id" title="variable">vs'</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hypothesis</span> <a id="evalCmd_coind.HC_While" class="idref" href="#evalCmd_coind.HC_While"><span class="id" title="variable">HC_While</span></a> : <span class="id" title="keyword">∀</span> <a id="vs:465" class="idref" href="#vs:465"><span class="id" title="binder">vs</span></a> <a id="vs':466" class="idref" href="#vs':466"><span class="id" title="binder">vs'</span></a> <a id="cond:467" class="idref" href="#cond:467"><span class="id" title="binder">cond</span></a> <a id="body:468" class="idref" href="#body:468"><span class="id" title="binder">body</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="cpdt_notes.html#evalCmd_coind.R"><span class="id" title="variable">R</span></a> <a class="idref" href="cpdt_notes.html#vs:465"><span class="id" title="variable">vs</span></a> (<a class="idref" href="cpdt_notes.html#C_While"><span class="id" title="constructor">C_While</span></a> <a class="idref" href="cpdt_notes.html#cond:467"><span class="id" title="variable">cond</span></a> <a class="idref" href="cpdt_notes.html#body:468"><span class="id" title="variable">body</span></a>) <a class="idref" href="cpdt_notes.html#vs':466"><span class="id" title="variable">vs'</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">(</span></a><a class="idref" href="cpdt_notes.html#evalExp"><span class="id" title="definition">evalExp</span></a> <a class="idref" href="cpdt_notes.html#vs:465"><span class="id" title="variable">vs</span></a> <a class="idref" href="cpdt_notes.html#cond:467"><span class="id" title="variable">cond</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> 0 <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="cpdt_notes.html#vs:465"><span class="id" title="variable">vs</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="cpdt_notes.html#vs':466"><span class="id" title="variable">vs'</span></a><a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">)</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">∨</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">(</span></a><a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">∃</span></a> <a id="vs'':469" class="idref" href="#vs'':469"><span class="id" title="binder">vs''</span></a><a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="cpdt_notes.html#evalExp"><span class="id" title="definition">evalExp</span></a> <a class="idref" href="cpdt_notes.html#vs:465"><span class="id" title="variable">vs</span></a> <a class="idref" href="cpdt_notes.html#cond:467"><span class="id" title="variable">cond</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> 0 <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><a class="idref" href="cpdt_notes.html#evalCmd_coind.R"><span class="id" title="variable">R</span></a> <a class="idref" href="cpdt_notes.html#vs:465"><span class="id" title="variable">vs</span></a> <a class="idref" href="cpdt_notes.html#body:468"><span class="id" title="variable">body</span></a> <a class="idref" href="cpdt_notes.html#vs'':469"><span class="id" title="variable">vs''</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="cpdt_notes.html#evalCmd_coind.R"><span class="id" title="variable">R</span></a> <a class="idref" href="cpdt_notes.html#vs'':469"><span class="id" title="variable">vs''</span></a> (<a class="idref" href="cpdt_notes.html#C_While"><span class="id" title="constructor">C_While</span></a> <a class="idref" href="cpdt_notes.html#cond:467"><span class="id" title="variable">cond</span></a> <a class="idref" href="cpdt_notes.html#body:468"><span class="id" title="variable">body</span></a>) <a class="idref" href="cpdt_notes.html#vs':466"><span class="id" title="variable">vs'</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a><a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">)</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <a id="evalCmd_coind" class="idref" href="#evalCmd_coind"><span class="id" title="lemma">evalCmd_coind</span></a> : <span class="id" title="keyword">∀</span> <a id="vs:472" class="idref" href="#vs:472"><span class="id" title="binder">vs</span></a> <a id="vs':473" class="idref" href="#vs':473"><span class="id" title="binder">vs'</span></a> <a id="c:474" class="idref" href="#c:474"><span class="id" title="binder">c</span></a>, <a class="idref" href="cpdt_notes.html#evalCmd_coind.R"><span class="id" title="variable">R</span></a> <a class="idref" href="cpdt_notes.html#vs:472"><span class="id" title="variable">vs</span></a> <a class="idref" href="cpdt_notes.html#c:474"><span class="id" title="variable">c</span></a> <a class="idref" href="cpdt_notes.html#vs':473"><span class="id" title="variable">vs'</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#evalCmd"><span class="id" title="inductive">evalCmd</span></a> <a class="idref" href="cpdt_notes.html#vs:472"><span class="id" title="variable">vs</span></a> <a class="idref" href="cpdt_notes.html#c:474"><span class="id" title="variable">c</span></a> <a class="idref" href="cpdt_notes.html#vs':473"><span class="id" title="variable">vs'</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">cofix</span> <span class="id" title="var">evalCmd_coind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">c</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<a class="idref" href="cpdt_notes.html#evalCmd_coind.HC_Asgn"><span class="id" title="variable">HC_Asgn</span></a> <span class="id" title="var">H</span>). <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<a class="idref" href="cpdt_notes.html#evalCmd_coind.HC_Seq"><span class="id" title="variable">HC_Seq</span></a> <span class="id" title="var">H</span>) <span class="id" title="keyword">as</span> [? [? ?]]. <span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<a class="idref" href="cpdt_notes.html#evalCmd_coind.HC_While"><span class="id" title="variable">HC_While</span></a> <span class="id" title="var">H</span>) <span class="id" title="keyword">as</span> [ [? ?] | [? [? [? ?]] ] ];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>; <span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="cpdt_notes.html#evalCmd_coind"><span class="id" title="section">evalCmd_coind</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab54"></a><h2 class="section">Q: Now write a simple optimizing pass replacing <span class="inlinecode">0</span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">e</span></span> with <span class="inlinecode"><span class="id" title="var">e</span></span>.</h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <a id="optExp" class="idref" href="#optExp"><span class="id" title="definition">optExp</span></a> (<a id="e:475" class="idref" href="#e:475"><span class="id" title="binder">e</span></a> : <a class="idref" href="cpdt_notes.html#exp"><span class="id" title="inductive">exp</span></a>) : <a class="idref" href="cpdt_notes.html#exp"><span class="id" title="inductive">exp</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="cpdt_notes.html#e:475"><span class="id" title="variable">e</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="cpdt_notes.html#E_Const"><span class="id" title="constructor">E_Const</span></a> <span class="id" title="var">n</span> ⇒ <a class="idref" href="cpdt_notes.html#e:475"><span class="id" title="variable">e</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="cpdt_notes.html#E_Var"><span class="id" title="constructor">E_Var</span></a> <span class="id" title="var">v</span>  ⇒ <a class="idref" href="cpdt_notes.html#e:475"><span class="id" title="variable">e</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="cpdt_notes.html#E_Plus"><span class="id" title="constructor">E_Plus</span></a> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> ⇒ (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="e1':478" class="idref" href="#e1':478"><span class="id" title="binder">e1'</span></a> := <a class="idref" href="cpdt_notes.html#optExp:476"><span class="id" title="definition">optExp</span></a> <span class="id" title="var">e1</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="e2':479" class="idref" href="#e2':479"><span class="id" title="binder">e2'</span></a> := <a class="idref" href="cpdt_notes.html#optExp:476"><span class="id" title="definition">optExp</span></a> <span class="id" title="var">e2</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="cpdt_notes.html#e1':478"><span class="id" title="variable">e1'</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="cpdt_notes.html#E_Const"><span class="id" title="constructor">E_Const</span></a> 0 ⇒ <a class="idref" href="cpdt_notes.html#e2':479"><span class="id" title="variable">e2'</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <a class="idref" href="cpdt_notes.html#E_Plus"><span class="id" title="constructor">E_Plus</span></a> <a class="idref" href="cpdt_notes.html#e1':478"><span class="id" title="variable">e1'</span></a> <a class="idref" href="cpdt_notes.html#e2':479"><span class="id" title="variable">e2'</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <a id="optCmd" class="idref" href="#optCmd"><span class="id" title="definition">optCmd</span></a> (<a id="c:481" class="idref" href="#c:481"><span class="id" title="binder">c</span></a> : <a class="idref" href="cpdt_notes.html#cmd"><span class="id" title="inductive">cmd</span></a>) : <a class="idref" href="cpdt_notes.html#cmd"><span class="id" title="inductive">cmd</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="cpdt_notes.html#c:481"><span class="id" title="variable">c</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="cpdt_notes.html#C_Asgn"><span class="id" title="constructor">C_Asgn</span></a> <span class="id" title="var">v</span> <span class="id" title="var">e</span> ⇒ <a class="idref" href="cpdt_notes.html#C_Asgn"><span class="id" title="constructor">C_Asgn</span></a> <span class="id" title="var">v</span> (<a class="idref" href="cpdt_notes.html#optExp"><span class="id" title="definition">optExp</span></a> <span class="id" title="var">e</span>)<br/>
&nbsp;&nbsp;| <a class="idref" href="cpdt_notes.html#C_Seq"><span class="id" title="constructor">C_Seq</span></a> <span class="id" title="var">c1</span> <span class="id" title="var">c2</span> ⇒ <a class="idref" href="cpdt_notes.html#C_Seq"><span class="id" title="constructor">C_Seq</span></a> (<a class="idref" href="cpdt_notes.html#optCmd:482"><span class="id" title="definition">optCmd</span></a> <span class="id" title="var">c1</span>) (<a class="idref" href="cpdt_notes.html#optCmd:482"><span class="id" title="definition">optCmd</span></a> <span class="id" title="var">c2</span>)<br/>
&nbsp;&nbsp;| <a class="idref" href="cpdt_notes.html#C_While"><span class="id" title="constructor">C_While</span></a> <span class="id" title="var">cond</span> <span class="id" title="var">body</span> ⇒ <a class="idref" href="cpdt_notes.html#C_While"><span class="id" title="constructor">C_While</span></a> (<a class="idref" href="cpdt_notes.html#optExp"><span class="id" title="definition">optExp</span></a> <span class="id" title="var">cond</span>) (<a class="idref" href="cpdt_notes.html#optCmd:482"><span class="id" title="definition">optCmd</span></a> <span class="id" title="var">body</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab55"></a><h2 class="section">Q: Prove <span class="inlinecode"><span class="id" title="var">optExp</span></span> correct.</h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a id="optExp_correct_v1" class="idref" href="#optExp_correct_v1"><span class="id" title="lemma">optExp_correct_v1</span></a> : <span class="id" title="keyword">∀</span> <a id="vs:484" class="idref" href="#vs:484"><span class="id" title="binder">vs</span></a> <a id="e:485" class="idref" href="#e:485"><span class="id" title="binder">e</span></a>, <a class="idref" href="cpdt_notes.html#evalExp"><span class="id" title="definition">evalExp</span></a> <a class="idref" href="cpdt_notes.html#vs:484"><span class="id" title="variable">vs</span></a> (<a class="idref" href="cpdt_notes.html#optExp"><span class="id" title="definition">optExp</span></a> <a class="idref" href="cpdt_notes.html#e:485"><span class="id" title="variable">e</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="cpdt_notes.html#evalExp"><span class="id" title="definition">evalExp</span></a> <a class="idref" href="cpdt_notes.html#vs:484"><span class="id" title="variable">vs</span></a> <a class="idref" href="cpdt_notes.html#e:485"><span class="id" title="variable">e</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">e</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="cpdt_notes.html#optExp"><span class="id" title="definition">optExp</span></a> <span class="id" title="var">e1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">destruct</span> <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHe1</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHe2</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHe1</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHe2</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHe1</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHe2</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHe1</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHe2</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="optExp_correct_v2" class="idref" href="#optExp_correct_v2"><span class="id" title="lemma">optExp_correct_v2</span></a> : <span class="id" title="keyword">∀</span> <a id="vs:486" class="idref" href="#vs:486"><span class="id" title="binder">vs</span></a> <a id="e:487" class="idref" href="#e:487"><span class="id" title="binder">e</span></a>, <a class="idref" href="cpdt_notes.html#evalExp"><span class="id" title="definition">evalExp</span></a> <a class="idref" href="cpdt_notes.html#vs:486"><span class="id" title="variable">vs</span></a> (<a class="idref" href="cpdt_notes.html#optExp"><span class="id" title="definition">optExp</span></a> <a class="idref" href="cpdt_notes.html#e:487"><span class="id" title="variable">e</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="cpdt_notes.html#evalExp"><span class="id" title="definition">evalExp</span></a> <a class="idref" href="cpdt_notes.html#vs:486"><span class="id" title="variable">vs</span></a> <a class="idref" href="cpdt_notes.html#e:487"><span class="id" title="variable">e</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">e</span>; <span class="id" title="var">crush</span>.<br/>

<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> <br/>
&nbsp;&nbsp;| [|- <span class="id" title="keyword">context</span>[ <span class="id" title="keyword">match</span> ?<span class="id" title="var">E</span> <span class="id" title="keyword">with</span> <a class="idref" href="cpdt_notes.html#E_Const"><span class="id" title="constructor">E_Const</span></a> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">_</span> | <span class="id" title="var">_</span> ⇒ <span class="id" title="var">_</span> <span class="id" title="keyword">end</span>]] ⇒ <span class="id" title="tactic">destruct</span> <span class="id" title="var">E</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span> ); <span class="id" title="var">crush</span>.<br/>

<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> <br/>
&nbsp;&nbsp;| [|- <span class="id" title="keyword">context</span>[ <span class="id" title="keyword">match</span> ?<span class="id" title="var">E</span> <span class="id" title="keyword">with</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#O"><span class="id" title="constructor">O</span></a> ⇒ <span class="id" title="var">_</span> | <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">_</span> <span class="id" title="keyword">end</span>]] ⇒ <span class="id" title="tactic">destruct</span> <span class="id" title="var">E</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span> ); <span class="id" title="var">crush</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="optExp_correct" class="idref" href="#optExp_correct"><span class="id" title="lemma">optExp_correct</span></a> : <span class="id" title="keyword">∀</span> <a id="vs:488" class="idref" href="#vs:488"><span class="id" title="binder">vs</span></a> <a id="e:489" class="idref" href="#e:489"><span class="id" title="binder">e</span></a>, <a class="idref" href="cpdt_notes.html#evalExp"><span class="id" title="definition">evalExp</span></a> <a class="idref" href="cpdt_notes.html#vs:488"><span class="id" title="variable">vs</span></a> (<a class="idref" href="cpdt_notes.html#optExp"><span class="id" title="definition">optExp</span></a> <a class="idref" href="cpdt_notes.html#e:489"><span class="id" title="variable">e</span></a>) <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="cpdt_notes.html#evalExp"><span class="id" title="definition">evalExp</span></a> <a class="idref" href="cpdt_notes.html#vs:488"><span class="id" title="variable">vs</span></a> <a class="idref" href="cpdt_notes.html#e:489"><span class="id" title="variable">e</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">e</span>; <span class="id" title="var">crush</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> <br/>
&nbsp;&nbsp;| [|- <span class="id" title="keyword">context</span>[ <span class="id" title="keyword">match</span> ?<span class="id" title="var">E</span> <span class="id" title="keyword">with</span> <a class="idref" href="cpdt_notes.html#E_Const"><span class="id" title="constructor">E_Const</span></a> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">_</span> | <span class="id" title="var">_</span>   ⇒ <span class="id" title="var">_</span> <span class="id" title="keyword">end</span>]] ⇒ <span class="id" title="tactic">destruct</span> <span class="id" title="var">E</span><br/>
&nbsp;&nbsp;| [|- <span class="id" title="keyword">context</span>[ <span class="id" title="keyword">match</span> ?<span class="id" title="var">E</span> <span class="id" title="keyword">with</span> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#O"><span class="id" title="constructor">O</span></a>         ⇒ <span class="id" title="var">_</span> | <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">_</span> <span class="id" title="keyword">end</span>]] ⇒ <span class="id" title="tactic">destruct</span> <span class="id" title="var">E</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>; <span class="id" title="var">crush</span>).<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Hint Rewrite</span> <a class="idref" href="cpdt_notes.html#optExp_correct"><span class="id" title="lemma">optExp_correct</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab56"></a><h2 class="section">Q: BONUS: Prove <span class="inlinecode"><span class="id" title="var">optCmd</span></span> correct (left unexplained in the book).</h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">finisher</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [<span class="id" title="var">H</span> : <a class="idref" href="cpdt_notes.html#evalCmd"><span class="id" title="inductive">evalCmd</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span>] ⇒ (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; []) ||<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; [|])<br/>
&nbsp;&nbsp;); <span class="id" title="tactic">subst</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>; <span class="id" title="var">crush</span>; <span class="id" title="tactic">eauto</span> 10.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="optCmd_correct1" class="idref" href="#optCmd_correct1"><span class="id" title="lemma">optCmd_correct1</span></a> : <span class="id" title="keyword">∀</span> <a id="vs1:490" class="idref" href="#vs1:490"><span class="id" title="binder">vs1</span></a> <a id="vs2:491" class="idref" href="#vs2:491"><span class="id" title="binder">vs2</span></a> <a id="c:492" class="idref" href="#c:492"><span class="id" title="binder">c</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="cpdt_notes.html#evalCmd"><span class="id" title="inductive">evalCmd</span></a> <a class="idref" href="cpdt_notes.html#vs1:490"><span class="id" title="variable">vs1</span></a> <a class="idref" href="cpdt_notes.html#c:492"><span class="id" title="variable">c</span></a> <a class="idref" href="cpdt_notes.html#vs2:491"><span class="id" title="variable">vs2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#evalCmd"><span class="id" title="inductive">evalCmd</span></a> <a class="idref" href="cpdt_notes.html#vs1:490"><span class="id" title="variable">vs1</span></a> (<a class="idref" href="cpdt_notes.html#optCmd"><span class="id" title="definition">optCmd</span></a> <a class="idref" href="cpdt_notes.html#c:492"><span class="id" title="variable">c</span></a>) <a class="idref" href="cpdt_notes.html#vs2:491"><span class="id" title="variable">vs2</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<a class="idref" href="cpdt_notes.html#evalCmd_coind"><span class="id" title="lemma">evalCmd_coind</span></a> (<span class="id" title="keyword">fun</span> <a id="vs1:493" class="idref" href="#vs1:493"><span class="id" title="binder"><span id="vs1:497" class="id">vs1</span></span></a> <a id="c':494" class="idref" href="#c':494"><span class="id" title="binder"><span id="c':498" class="id">c'</span></span></a> <a id="vs2:495" class="idref" href="#vs2:495"><span class="id" title="binder"><span id="vs2:499" class="id">vs2</span></span></a> ⇒ <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">∃</span></a> <a id="c:496" class="idref" href="#c:496"><span class="id" title="binder"><span id="c:500" class="id">c</span></span></a><a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="cpdt_notes.html#evalCmd"><span class="id" title="inductive">evalCmd</span></a> <a class="idref" href="cpdt_notes.html#vs1:493"><span class="id" title="variable">vs1</span></a> <a class="idref" href="cpdt_notes.html#c:496"><span class="id" title="variable">c</span></a> <a class="idref" href="cpdt_notes.html#vs2:495"><span class="id" title="variable">vs2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="cpdt_notes.html#c':494"><span class="id" title="variable">c'</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="cpdt_notes.html#optCmd"><span class="id" title="definition">optCmd</span></a> <a class="idref" href="cpdt_notes.html#c:496"><span class="id" title="variable">c</span></a><br/>
&nbsp;&nbsp;)); <span class="id" title="tactic">eauto</span>; <span class="id" title="var">crush</span>;<br/>
<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H2</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">injection</span> <span class="id" title="var">H2</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="var">finisher</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="optCmd_correct2" class="idref" href="#optCmd_correct2"><span class="id" title="lemma">optCmd_correct2</span></a> : <span class="id" title="keyword">∀</span> <a id="vs1:501" class="idref" href="#vs1:501"><span class="id" title="binder">vs1</span></a> <a id="vs2:502" class="idref" href="#vs2:502"><span class="id" title="binder">vs2</span></a> <a id="c:503" class="idref" href="#c:503"><span class="id" title="binder">c</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="cpdt_notes.html#evalCmd"><span class="id" title="inductive">evalCmd</span></a> <a class="idref" href="cpdt_notes.html#vs1:501"><span class="id" title="variable">vs1</span></a> (<a class="idref" href="cpdt_notes.html#optCmd"><span class="id" title="definition">optCmd</span></a> <a class="idref" href="cpdt_notes.html#c:503"><span class="id" title="variable">c</span></a>) <a class="idref" href="cpdt_notes.html#vs2:502"><span class="id" title="variable">vs2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="cpdt_notes.html#evalCmd"><span class="id" title="inductive">evalCmd</span></a> <a class="idref" href="cpdt_notes.html#vs1:501"><span class="id" title="variable">vs1</span></a> <a class="idref" href="cpdt_notes.html#c:503"><span class="id" title="variable">c</span></a> <a class="idref" href="cpdt_notes.html#vs2:502"><span class="id" title="variable">vs2</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Check</span> <a class="idref" href="cpdt_notes.html#evalCmd_coind"><span class="id" title="lemma">evalCmd_coind</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> (<a class="idref" href="cpdt_notes.html#evalCmd_coind"><span class="id" title="lemma">evalCmd_coind</span></a> (<span class="id" title="keyword">fun</span> <a id="vs:504" class="idref" href="#vs:504"><span class="id" title="binder"><span id="vs:507" class="id">vs</span></span></a> <a id="c:505" class="idref" href="#c:505"><span class="id" title="binder"><span id="c:508" class="id">c</span></span></a> <a id="vs':506" class="idref" href="#vs':506"><span class="id" title="binder"><span id="vs':509" class="id">vs'</span></span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="cpdt_notes.html#evalCmd"><span class="id" title="inductive">evalCmd</span></a> <a class="idref" href="cpdt_notes.html#vs:504"><span class="id" title="variable">vs</span></a> (<a class="idref" href="cpdt_notes.html#optCmd"><span class="id" title="definition">optCmd</span></a> <a class="idref" href="cpdt_notes.html#c:505"><span class="id" title="variable">c</span></a>) <a class="idref" href="cpdt_notes.html#vs':506"><span class="id" title="variable">vs'</span></a><br/>
&nbsp;&nbsp;)); <span class="id" title="tactic">eauto</span>; <span class="id" title="var">crush</span>; <span class="id" title="var">finisher</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Theorem</span> <a id="optCmd_correct" class="idref" href="#optCmd_correct"><span class="id" title="lemma">optCmd_correct</span></a> : <span class="id" title="keyword">∀</span> <a id="vs1:510" class="idref" href="#vs1:510"><span class="id" title="binder">vs1</span></a> <a id="vs2:511" class="idref" href="#vs2:511"><span class="id" title="binder">vs2</span></a> <a id="c:512" class="idref" href="#c:512"><span class="id" title="binder">c</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="cpdt_notes.html#evalCmd"><span class="id" title="inductive">evalCmd</span></a> <a class="idref" href="cpdt_notes.html#vs1:510"><span class="id" title="variable">vs1</span></a> (<a class="idref" href="cpdt_notes.html#optCmd"><span class="id" title="definition">optCmd</span></a> <a class="idref" href="cpdt_notes.html#c:512"><span class="id" title="variable">c</span></a>) <a class="idref" href="cpdt_notes.html#vs2:511"><span class="id" title="variable">vs2</span></a> <a class="idref" href="http://rocq-prover.org/doc/V9.1.0/stdlib//Corelib.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">↔</span></a> <a class="idref" href="cpdt_notes.html#evalCmd"><span class="id" title="inductive">evalCmd</span></a> <a class="idref" href="cpdt_notes.html#vs1:510"><span class="id" title="variable">vs1</span></a> <a class="idref" href="cpdt_notes.html#c:512"><span class="id" title="variable">c</span></a> <a class="idref" href="cpdt_notes.html#vs2:511"><span class="id" title="variable">vs2</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intuition</span>; <span class="id" title="tactic">apply</span> <a class="idref" href="cpdt_notes.html#optCmd_correct1"><span class="id" title="lemma">optCmd_correct1</span></a> || <span class="id" title="tactic">apply</span> <a class="idref" href="cpdt_notes.html#optCmd_correct2"><span class="id" title="lemma">optCmd_correct2</span></a>; <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Check</span> 0.<br/>

<br/>
</div>
<hr/>This page has been generated by <a href="http://rocq-prover.org/">coqdoc</a>
</div>

</div>

</body>
</html>